import{bG as H,aH as I,r as m,j as e,aC as o,bf as g,B as v,as as b,aE as u}from"./index-BUuDiwj7.js";import{i as M,C as i}from"./ClassicLayout-CYxuLII9.js";import{C as P,p as N}from"./CustomerTable-C8suh5v3.js";import{f as p}from"./format-DCu_5tSO.js";import"./index.esm-GO8f22Rh.js";import"./index-DR2EJYmU.js";import"./context-Ud1heqGj.js";import"./useMergedState-WpmTD-Z3.js";import"./index-DJYmzwsa.js";import"./compact-item-CdxjwPt-.js";import"./ContextIsolator-DCpnduWR.js";import"./button-B4su9yKu.js";const z=()=>{const{id:d}=H(),h=I(),[C,x]=m.useState(!1),[k,S]=m.useState(null),[y,j]=m.useState([]),{control:l,handleSubmit:D,watch:f,setValue:n,formState:{errors:c}}=M(),q=f("typeTicket");m.useEffect(()=>{d&&(async()=>{try{const a=await b.get(`/voucher/${d}`),{countOrders:r}=a.data;u.success(`Số lượt sử dụng: ${r??0}`);const t=a.data;S(t),n("name",t.name),n("code",t.code),n("typeTicket",t.typeTicket),n("quantity",t.quantity),n("maxPercent",t.maxPercent),n("minAmount",t.minAmount),n("startDate",p(t.startDate,"yyyy-MM-dd'T'HH:mm")),n("endDate",p(t.endDate,"yyyy-MM-dd'T'HH:mm")),j(t.customers||[])}catch{u.error("Không thể tải thông tin voucher"),h("/admin/manage/voucher")}})()},[d,n,h]);const T=async s=>{x(!0);try{const a=N(s.startDate),r=N(s.endDate);(await b.put(`/voucher/update/${d}`,{...s,startDate:p(a,"yyyy-MM-dd'T'HH:mm"),endDate:p(r,"yyyy-MM-dd'T'HH:mm"),customers:y})).status===200&&(u.success("Cập nhật voucher thành công"),h("/admin/manage/voucher"))}catch{u.error("Cập nhật voucher thất bại")}finally{x(!1)}},V=m.useCallback(s=>{const a=s.map(r=>r.id);j(a)},[]);return k?e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Cập Nhật Phiếu Giảm Giá"}),e.jsxs("form",{onSubmit:D(T),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Tên phiếu"}),e.jsx(i,{name:"name",control:l,rules:{required:"Vui lòng nhập tên phiếu"},render:({field:s})=>{var a;return e.jsx(o,{...s,placeholder:"Nhập tên phiếu",error:(a=c.name)==null?void 0:a.message})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Mã phiếu"}),e.jsx(i,{name:"code",control:l,rules:{required:"Vui lòng nhập mã phiếu"},render:({field:s})=>{var a;return e.jsx(o,{...s,placeholder:"Nhập mã phiếu",error:(a=c.code)==null?void 0:a.message})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Số lượng"}),e.jsx(i,{name:"quantity",control:l,rules:{required:"Vui lòng nhập số lượng",min:{value:1,message:"Số lượng phải lớn hơn 0"}},render:({field:s})=>{var a;return e.jsx(o,{...s,type:"number",placeholder:"Nhập số lượng",error:(a=c.quantity)==null?void 0:a.message})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Phần trăm giảm tối đa"}),e.jsx(i,{name:"maxPercent",control:l,rules:{required:"Vui lòng nhập phần trăm giảm",min:{value:1,message:"Phần trăm ít nhất là 1"},max:{value:100,message:"Phần trăm không được vượt quá 100"}},render:({field:s})=>{var a;return e.jsx(o,{...s,type:"number",placeholder:"Nhập phần trăm giảm",error:(a=c.maxPercent)==null?void 0:a.message})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Số tiền tối thiểu"}),e.jsx(i,{name:"minAmount",control:l,rules:{required:"Vui lòng nhập số tiền tối thiểu",min:{value:0,message:"Số tiền không được âm"}},render:({field:s})=>{var a;return e.jsx(o,{...s,type:"number",placeholder:"Nhập số tiền tối thiểu",error:(a=c.minAmount)==null?void 0:a.message})}})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block mb-2",children:"Ngày bắt đầu"}),e.jsx(i,{name:"startDate",control:l,rules:{required:"Vui lòng chọn ngày bắt đầu"},render:({field:s})=>{var a;return e.jsx(o,{...s,type:"datetime-local",value:s.value?new Date(s.value).toLocaleString("sv-SE").slice(0,16):"",onChange:r=>s.onChange(r.target.value),placeholder:"Chọn ngày bắt đầu",error:(a=c.startDate)==null?void 0:a.message})}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block mb-2",children:"Ngày kết thúc"}),e.jsx(i,{name:"endDate",control:l,rules:{required:"Vui lòng chọn ngày kết thúc"},render:({field:s})=>{var a;return e.jsx(o,{...s,type:"datetime-local",value:s.value?new Date(s.value).toLocaleString("sv-SE").slice(0,16):"",onChange:r=>s.onChange(r.target.value),placeholder:"Chọn ngày kết thúc",error:(a=c.endDate)==null?void 0:a.message})}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Loại phiếu giảm giá"}),e.jsx(i,{name:"typeTicket",control:l,rules:{required:"Vui lòng chọn loại phiếu"},render:({field:s})=>e.jsxs(g.Group,{value:s.value,onChange:s.onChange,children:[e.jsx(g,{value:"Individual",children:"Cá nhân"}),e.jsx(g,{value:"Everybody",children:"Tất cả"})]})})]})]}),q==="Individual"&&e.jsxs("div",{className:"space-y-6 border border-gray-300 rounded-lg p-4",children:[e.jsx("label",{className:"block mb-2",children:"Chọn khách hàng"}),e.jsx(P,{onSelectedCustomersChange:V,selectedCustomerIds:y})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(v,{type:"button",variant:"plain",onClick:()=>h("/admin/manage/voucher"),children:"Hủy"}),e.jsx(v,{loading:C,variant:"solid",type:"submit",children:"Cập nhật"})]})]})]}):e.jsx("div",{children:"Loading..."})};export{z as default};
