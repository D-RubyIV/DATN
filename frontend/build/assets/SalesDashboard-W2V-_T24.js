import{r as c,bR as G,bS as le,bT as ce,bU as ie,f as z,j as e,bV as de,bW as he,bX as ue,bY as xe,n as T,bM as x,bZ as ge,E as N,bo as P,b_ as pe,b$ as S,c0 as me,c1 as fe,b3 as je,b4 as K,c2 as be,c3 as Ce,bf as w,c4 as k,c5 as De,c6 as ve,aQ as V,c7 as ye,B as Oe,L as Se,b7 as Te,C as Ne,aH as we,bz as ee,br as te,bE as se,bx as E,by as R,T as J,aK as Re,c8 as Ee,c9 as Me,ca as Q,cb as Ae,cc as Le,cd as He}from"./index-D3Ws-_hT.js";const U=["line","bar","area"],ae=a=>{const{series:t=[],width:s="100%",height:n=300,xAxis:r,customOptions:o,type:i="line",direction:l,donutTitle:D,donutText:u,className:M,...j}=a,d=c.useRef(null),b=c.useMemo(()=>{switch(i){case"line":return G;case"bar":return ie;case"area":return ce;case"donut":return le;default:return G}},[i]);let h=JSON.parse(JSON.stringify(b));const m=window.innerWidth<768,v=c.useCallback(()=>{if(d.current){const g=d.current.querySelectorAll("div.apexcharts-legend")[0];l===z&&(g.style.right="auto",g.style.left="0"),m&&(g.style.position="relative",g.style.top="0",g.style.justifyContent="start",g.style.padding="0")}},[l,m]);return c.useEffect(()=>{U.includes(i)&&v()},[i,v]),U.includes(i)&&(h.xaxis.categories=r),o&&(h={...h,...o}),i==="donut"&&(D&&(h.plotOptions.pie.donut.labels.total.label=D),u&&(h.plotOptions.pie.donut.labels.total.formatter=()=>u)),e.jsx("div",{ref:d,style:l===z?{direction:"ltr"}:{},className:"chartRef",children:e.jsx(de,{options:h,type:i,series:t,width:s,height:n,className:M,...j})})},ke=he({object:ue}),p=xe,I=({value:a,growShrink:t,label:s,valuePrefix:n,message:r})=>e.jsxs(N,{children:[e.jsx("h6",{className:"font-semibold mb-4 text-sm",children:s}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:e.jsx(P,{thousandSeparator:!0,displayType:"text",value:a,prefix:n})}),e.jsxs("p",{children:[r," "]})]}),e.jsx(pe,{value:t,suffix:"%"})]})]}),Ie=()=>{var F,q,_;const a=T(),t=p(f=>f.statistic.startDate),s=p(f=>f.statistic.overviewOneMonthData),n=x().subtract(1,"day").startOf("day").toDate(),r=x().subtract(1,"day").endOf("day").toDate(),o=x().startOf("week"),i=o.subtract(1,"week"),l=o.subtract(1,"day"),D=x().startOf("month"),u=x().subtract(1,"month").startOf("month"),M=D.subtract(1,"day"),j=(f,y,O)=>Array.isArray(f)&&f.reduce((L,H)=>{const Y=new Date(H.createDate);return Y>=y&&Y<O&&(L.quantityOrder+=H.quantityOrder,L.totalRevenue+=H.totalRevenue),L},{quantityOrder:0,totalRevenue:0}),d=c.useMemo(()=>{const f=x().startOf("day").toDate(),y=x().endOf("day").toDate();return j(s,f,y)},[s]);console.log("DOANH SO HOM NAY: ",d==null?void 0:d.totalRevenue);const b=c.useMemo(()=>j(s,n,r),[s]);console.log("DOANH SO HOM QUA: ",b==null?void 0:b.totalRevenue);const h=c.useMemo(()=>j(s,o.toDate(),x().endOf("day").toDate()),[s]),m=c.useMemo(()=>j(s,D.toDate(),x().endOf("day").toDate()),[s]),v=c.useMemo(()=>j(s,i.toDate(),l.toDate()),[s]),g=c.useMemo(()=>j(s,u.toDate(),M.toDate()),[s]);c.useEffect(()=>{a(ge())},[a]);const A=(f,y,O)=>(console.log(y,O),O===0?100:(y-O)/O*100),ne=A("day",(d==null?void 0:d.totalRevenue)??0,(b==null?void 0:b.totalRevenue)??0),re=A("week",(h==null?void 0:h.totalRevenue)??0,(v==null?void 0:v.totalRevenue)??0),oe=A("month",(m==null?void 0:m.totalRevenue)??0,(g==null?void 0:g.totalRevenue)??0);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(I,{value:((F=d==null?void 0:d.totalRevenue)==null?void 0:F.toFixed())??"0",growShrink:Math.round(ne),message:"So với "+x(n).format("DD-MM-YYYY"),label:"Doanh số hôm nay",date:t}),e.jsx(I,{value:((q=h==null?void 0:h.totalRevenue)==null?void 0:q.toFixed())??"0",growShrink:Math.round(re),message:"So với tuần trước",label:"Doanh số tuần này",date:t}),e.jsx(I,{value:((_=m==null?void 0:m.totalRevenue)==null?void 0:_.toFixed())??"0",growShrink:Math.round(oe),message:"So với tháng trước",label:"Doanh số tháng này",date:t})]})},$e=()=>{const a=T(),t=p(l=>l.statistic.timeOption),s=p(l=>l.statistic.overviewChartData),n=p(l=>l.statistic.chartMode),[r,o]=c.useState({series:[{name:"Session Duration",data:[]}],categories:Array.isArray(s)?s.map(l=>l.symbol):[]});c.useEffect(()=>{const l=[],D=Array.isArray(s)?s.map(u=>u.symbol):[];n===0?l.push({name:"Số lượng sản phẩm",data:Array.isArray(s)?s.map(u=>u.quantity):[]}):l.push({name:"Doanh số",data:Array.isArray(s)?s.map(u=>Number(u.revenue.toFixed(0))):[]}),o(u=>({...u,series:l,categories:D}))},[n,s]),c.useEffect(()=>{a(S())},[]);const i=l=>{console.log(l),a(De(l))};return c.useEffect(()=>{console.log("Change selectedTimeOption",t),a(S())},[t]),e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{children:"Thống kê"}),e.jsx(me,{defaultValue:"tab1",value:n.toString(),onChange:l=>a(fe(Number(l))),children:e.jsxs(je,{children:[e.jsx(K,{value:"0",icon:e.jsx(be,{}),children:"Số lượng"}),e.jsx(K,{value:"1",icon:e.jsx(Ce,{}),children:"Doanh số"})]})}),e.jsx("div",{children:e.jsxs(w.Group,{value:t,onChange:l=>i(l),children:[e.jsx(w,{value:k.DAILY,children:"Ngày"}),e.jsx(w,{value:k.MONTHLY,children:"Tháng"}),e.jsx(w,{value:k.YEARLY,children:"Năm"})]})})]}),e.jsx(ae,{series:r.series,xAxis:r.categories,height:400,type:"bar"})]})},Be=()=>{const a=T(),t=p(n=>n.statistic.saleByCategoriesData);c.useEffect(()=>{console.log(t),console.log(s)},[]);const s={data:t?[t.countPending||0,t.countToShip||0,t.countToReceive||0,t.countDelivered||0,t.countCancelled||0]:[],labels:["Chờ xác nhận","Chờ thanh toán","Chờ vận chuyển","Đã hoàn thành","Đã hủy hàng"]};return c.useEffect(()=>{t||a(ve())},[a,t]),e.jsxs(N,{children:[e.jsx("h4",{children:"Danh mục"}),e.jsx("div",{className:"mt-6",children:Array.isArray(s.data)&&s.data.length>0&&e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{children:e.jsx(ae,{donutTitle:`${s.data.reduce((n,r)=>n+r,0)}`,donutText:"Đơn hàng",series:s.data,customOptions:{labels:s.labels},type:"donut"})}),s.data.length===s.labels.length&&e.jsx("div",{className:"mt-6 grid grid-cols-1 gap-4 w-4/5 mx-auto",children:s.labels.map((n,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{badgeStyle:{backgroundColor:ye[r]}}),e.jsx("span",{className:"font-semibold",children:n})]},n))})]})})]})},{Tr:W,Td:Pe,TBody:Ve,THead:Fe,Th:qe}=E,$={PENDING:{label:"Chờ xác nhận",dotClass:"bg-yellow-500",textClass:"text-yellow-500"},TOSHIP:{label:"Chờ vận chuyển",dotClass:"bg-blue-500",textClass:"text-blue-500"},TORECEIVE:{label:"Đang vận chuyển",dotClass:"bg-green-500",textClass:"text-green-500"},DELIVERED:{label:"Đã hoàn thành",dotClass:"bg-purple-500",textClass:"text-purple-500"},CANCELED:{label:"Đã hủy đơn",dotClass:"bg-red-500",textClass:"text-red-500"}},B={INSTORE:{label:"Tại quầy",dotClass:"bg-yellow-500",textClass:"text-yellow-500"},ONLINE:{label:"Giao hàng",dotClass:"bg-blue-500",textClass:"text-blue-500"}},_e=({row:a})=>{const{textTheme:t}=Ne(),s=we(),n=c.useCallback(()=>{s(`/app/sales/order-details/${a.id}`)},[s,a]);return e.jsxs("span",{className:`cursor-pointer select-none font-semibold hover:${t}`,onClick:n,children:["#",a.id]})},C=ee(),Ye=[C.accessor("id",{header:"Đơn hàng",cell:a=>e.jsx(_e,{row:a.row.original})}),C.accessor("status",{header:"Trạng thái",cell:a=>{var s,n,r;const{status:t}=a.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:(s=$[t])==null?void 0:s.dotClass}),e.jsx("span",{className:`ml-2 rtl:mr-2 capitalize font-semibold ${(n=$[t])==null?void 0:n.textClass}`,children:(r=$[t])==null?void 0:r.label})]})}}),C.accessor("type",{header:"Loại",cell:a=>{const{type:t}=a.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:B[t].dotClass}),e.jsx("span",{className:`ml-2 rtl:mr-2 capitalize font-semibold ${B[t].textClass}`,children:B[t].label})]})}}),C.accessor("createdDate",{header:"Ngày tạo",cell:a=>{const t=a.row.original;return e.jsx("span",{children:t.createdDate})}}),C.accessor("customerName",{header:"Khách hàng",cell:a=>{const t=a.row.original;return e.jsx("span",{children:t.customerName??"Khách lẻ"})}}),C.accessor("subTotal",{header:"Doanh số",cell:a=>{const t=a.row.original;return e.jsx(P,{displayType:"text",value:(Math.round(t.subTotal*100)/100).toFixed(0),suffix:"đ",thousandSeparator:!0})}}),C.accessor("total",{header:"Cần TT",cell:a=>{const{total:t}=a.row.original;return e.jsx(P,{displayType:"text",value:(Math.round(t*100)/100).toFixed(0),suffix:"đ",thousandSeparator:!0})}}),C.accessor("id",{header:"Hành động",cell:a=>{const{id:t}=a.row.original;return e.jsx(Oe,{size:"xs",className:"w-full flex justify-start items-center",variant:"plain",children:e.jsx(Se,{to:`/admin/manage/order/order-details/${t}`,children:e.jsx(Te,{size:20,className:"mr-3 text-2xl",style:{cursor:"pointer"}})})})}})],Ge=({data:a=[],className:t})=>{const s=te({data:a,columns:Ye,getCoreRowModel:se()});return e.jsxs(N,{className:t,children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h4",{children:"Đơn hàng gần đây"})}),e.jsxs(E,{children:[e.jsx(Fe,{children:s.getHeaderGroups().map((n,r)=>e.jsx(W,{children:n.headers.map((o,i)=>e.jsx(qe,{colSpan:o.colSpan,children:R(o.column.columnDef.header,o.getContext())},i))},r))}),e.jsx(Ve,{children:s.getRowModel().rows.map((n,r)=>e.jsx(W,{children:n.getVisibleCells().map((o,i)=>e.jsx(Pe,{children:R(o.column.columnDef.cell,o.getContext())},i))},r))})]})]})},{Tr:X,Td:ze,TBody:Ke,THead:Je,Th:Qe}=E,Ue=({row:a})=>{const t=a.img?e.jsx(J,{src:a.img,className:"w-[250px]"}):e.jsx(J,{icon:e.jsx(Re,{})});return e.jsxs("div",{className:"flex items-center gap-2",children:[t,e.jsx("span",{className:"font-semibold",children:a.name})]})},Z=ee(),We=[Z.accessor("name",{header:"Product",cell:a=>{const t=a.row.original;return e.jsx(Ue,{row:t})}}),Z.accessor("sold",{header:"Sold"})],Xe=({data:a=[],className:t})=>{const s=te({data:a,columns:We,getCoreRowModel:se()});return e.jsxs(N,{className:t,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h4",{children:"Top thịnh hành"})}),e.jsxs(E,{children:[e.jsx(Je,{children:s.getHeaderGroups().map(n=>e.jsx(X,{children:n.headers.map(r=>e.jsx(Qe,{colSpan:r.colSpan,children:R(r.column.columnDef.header,r.getContext())},r.id))},n.id))}),e.jsx(Ke,{children:s.getRowModel().rows.map(n=>e.jsx(X,{children:n.getVisibleCells().map(r=>e.jsx(ze,{children:R(r.column.columnDef.cell,r.getContext())},r.id))},n.id))})]})]})},Ze=()=>{const a=T(),t=p(n=>n.statistic.listTopProduct),s=p(n=>n.statistic.listLatestOrders);return c.useEffect(()=>{a(Ee()),a(Me())},[]),e.jsxs(c.Fragment,{children:[e.jsx(Ie,{}),e.jsxs("div",{className:"grid grid-cols-1 2xl:grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx($e,{})}),e.jsx(Be,{})]}),e.jsxs("div",{className:"grid grid-cols-1 2xl:grid-cols-3 gap-4",children:[e.jsx(Ge,{data:s,className:"lg:col-span-2"}),e.jsx(Xe,{data:t})]})]})},et=()=>{const a=T(),t=p(o=>o.statistic.startDateChart),s=p(o=>o.statistic.endDateChart),n=o=>{console.log("-------"),console.log(o),o&&(a(Ae(o.toISOString())),a(S()))},r=o=>{console.log("-------"),console.log(o),o&&(a(Le(o.toISOString())),a(S()))};return c.useEffect(()=>{S()},[t,s]),e.jsxs("div",{className:"lg:flex items-center justify-between mb-4 gap-3",children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[e.jsx("h3",{children:"Tổng quan bán hàng"}),e.jsx("p",{children:"Xem doanh số và tóm tắt hiện tại của bạn"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3",children:[e.jsx(Q,{value:x(t).toDate(),placeholder:"Pick a date",onChange:n}),e.jsx(Q,{value:x(s).toDate(),placeholder:"Pick a date",onChange:r})]})]})};He("STATISTIC_SLICE",ke);const st=()=>e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsx(et,{}),e.jsx(Ze,{})]});export{st as default};
