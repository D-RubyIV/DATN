import{at as I,au as g,bF as v,cl as H,r as f,j as e,ax as A,cm as E,ay as L,az as B,aA as c,aB as l,aC as o,B as z,aH as Q,L as R,cn as N,co as V,as as $}from"./index-BUuDiwj7.js";import{S as O}from"./StickyFooter-BS3oJDzh.js";import{p as P,C as K}from"./CustomerTable-C8suh5v3.js";import{f as x}from"./format-DCu_5tSO.js";import{h as J}from"./ClassicLayout-CYxuLII9.js";import"./index.esm-GO8f22Rh.js";import"./index-DR2EJYmU.js";import"./context-Ud1heqGj.js";import"./useMergedState-WpmTD-Z3.js";import"./index-DJYmzwsa.js";import"./compact-item-CdxjwPt-.js";import"./ContextIsolator-DCpnduWR.js";import"./button-B4su9yKu.js";const U=I().shape({name:g().required("Tên voucher không được để trống").min(3,"Tên voucher phải có ít nhất 3 ký tự").max(50,"Tên voucher không vượt quá 50 ký tự").test("no-whitespace","Tên voucher không được chứa nhiều khoảng trắng",n=>n.trim()===n&&!n.includes("  ")),minAmount:v().min(0,"Giá trị tối thiểu phải lớn hơn hoặc bằng 0").required("Vui lòng nhập giá trị tối thiểu"),maxPercent:v().min(1,"Phần trăm giảm giá phải lớn hơn hoặc bằng 1").max(100,"Phần trăm giảm giá không thể vượt quá 100").required("Vui lòng nhập phần trăm giảm giá"),typeTicket:g().oneOf(["Individual","Everybody"],"Loại voucher không hợp lệ").required("Vui lòng chọn loại voucher"),quantity:v().min(1,"Số lượng phải ít nhất là 1").required("Vui lòng nhập số lượng"),startDate:g().required("Vui lòng chọn ngày bắt đầu"),endDate:g().required("Vui lòng chọn ngày kết thúc").test("is-after-start","Ngày kết thúc phải sau ngày bắt đầu",function(n){const{startDate:m}=this.parent;return!m||!n?!0:new Date(n)>new Date(m)})}),W={name:"",code:"",typeTicket:"Everybody",quantity:1,maxPercent:0,minAmount:0,startDate:x(new Date,"yyyy-MM-dd'T'HH:mm"),endDate:x(H(new Date,7),"yyyy-MM-dd'T'HH:mm"),customers:[]},F=f.forwardRef((n,m)=>{const[h,y]=f.useState([]),b=f.useCallback(u=>{const t=u.map(a=>a.id);y(t)},[]),{type:s,initialData:r=W,onFormSubmit:d,onDiscard:X}=n;return e.jsx(e.Fragment,{children:e.jsx(A,{innerRef:m,initialValues:r,validationSchema:U,onSubmit:(u,{setSubmitting:t})=>{const a=E(u);a.customers=h,d==null||d(a,t)},children:({values:u,touched:t,errors:a,isSubmitting:G})=>{var k,D,C,T,M,S,w,q;return e.jsx(L,{children:e.jsxs(B,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(c,{asterisk:!0,label:"Tên Phiếu Giảm Giá:",invalid:a.name&&t.name,errorMessage:(k=a.name)==null?void 0:k.toString(),children:e.jsx(l,{type:"text",autoComplete:"off",name:"name",placeholder:"Tên phiếu giảm giá",component:o,className:"w-full"})}),e.jsx(c,{label:"Mã Phiếu Giảm Giá:",invalid:a.code&&t.code,errorMessage:(D=a.code)==null?void 0:D.toString(),children:e.jsxs("div",{className:"relative group",children:[e.jsx(l,{type:"text",autoComplete:"off",name:"code",placeholder:"Mã phiếu giảm giá",component:o,className:"w-full"}),e.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 text-red-500 hidden bg-white border border-gray-300 p-2 z-10 group-hover:block",children:"Mã có thể nhập hoặc hệ thống sẽ tự động tạo mã"})]})}),e.jsx(c,{label:"Số Lượng:",asterisk:!0,invalid:a.quantity&&t.quantity,errorMessage:(C=a.quantity)==null?void 0:C.toString(),children:e.jsx(l,{type:"number",autoComplete:"off",name:"quantity",placeholder:"Quantity",component:o,className:"w-full "})}),e.jsx(c,{label:"Phần trăm giảm giá tối đa",asterisk:!0,invalid:a.maxPercent&&t.maxPercent,errorMessage:(T=a.maxPercent)==null?void 0:T.toString(),children:e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(l,{type:"number",autoComplete:"off",name:"maxPercent",placeholder:"Phần trăm giảm giá tối đa",component:o,className:"w-full pr-12"}),e.jsx("span",{className:"absolute right-1 text-gray-500",children:"%"})]})}),e.jsxs(c,{label:"Giá tối thiểu",asterisk:!0,invalid:a.minAmount&&t.minAmount,errorMessage:(M=a.minAmount)==null?void 0:M.toString(),children:[e.jsx(l,{type:"number",autoComplete:"off",name:"minAmount",placeholder:"Giá tối thiểu",component:o,className:"w-full pr-12"}),e.jsx("span",{className:"absolute right-1 text-gray-500 mt-3",children:"VNĐ"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{label:"Ngày Bắt Đầu",asterisk:!0,invalid:a.startDate&&t.startDate,errorMessage:(S=a.startDate)==null?void 0:S.toString(),children:e.jsx(l,{name:"startDate",children:({field:i,form:p})=>e.jsx(o,{type:"datetime-local",autoComplete:"off",value:i.value?x(P(i.value),"yyyy-MM-dd'T'HH:mm"):"",onChange:j=>p.setFieldValue(i.name,j.target.value),placeholder:"Start Date"})})}),e.jsx(c,{label:"Ngày Kết Thúc",asterisk:!0,invalid:a.endDate&&t.endDate,errorMessage:(w=a.endDate)==null?void 0:w.toString(),children:e.jsx(l,{name:"endDate",children:({field:i,form:p})=>e.jsx(o,{type:"datetime-local",autoComplete:"off",value:i.value?x(P(i.value),"yyyy-MM-dd'T'HH:mm"):"",onChange:j=>p.setFieldValue(i.name,j.target.value),placeholder:"End Date"})})})]}),e.jsx(c,{label:"Loại Phiếu Giảm Giá",asterisk:!0,invalid:a.typeTicket&&t.typeTicket,errorMessage:(q=a.typeTicket)==null?void 0:q.toString(),children:e.jsx(l,{name:"typeTicket",children:({field:i,form:p})=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx(l,{type:"radio",name:"typeTicket",value:"Individual",className:"form-radio",checked:i.value==="Individual"}),e.jsx("span",{children:"Cá Nhân"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx(l,{type:"radio",name:"typeTicket",value:"Everybody",className:"form-radio",checked:i.value==="Everybody"}),e.jsx("span",{children:"Mọi Người"})]})]})})})]}),e.jsx("div",{className:"lg:col-span-2 border border-gray-300 rounded-lg p-4",children:e.jsx(K,{selectedCustomerIds:h,onSelectedCustomersChange:b})})]}),e.jsx(O,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"md:flex items-center",children:e.jsx(z,{color:"blue",size:"sm",variant:"solid",loading:G,type:"submit",children:"Lưu"})})})]})})}})})});F.displayName="VoucherForm";const me=()=>{const n=Q(),m=async s=>{try{return(await $.post("/voucher/add",s)).status}catch(r){return console.error("Error adding voucher:",r),!1}},h=async(s,r)=>{try{r(!0),await m(s)==201?(N.push("Thêm mới thành công"),n("/admin/manage/voucher")):N.push(e.jsx(V,{title:"Thêm mới thất bại!",type:"danger",duration:2500}),{placement:"top-center"})}catch{N.push(e.jsx(V,{title:"Đã xảy ra lỗi!",type:"danger",duration:2500}),{placement:"top-center"})}finally{r(!1)}},y=()=>{n("/admin/manager/voucher")},b=[{label:"Trang Chủ",path:"/"},{label:"Quản Lý",path:"/manage"},{label:"Quản Lý Voucher",path:"/manage/voucher"},{label:"Thêm Phiếu Giảm Giá",path:"",current:!0}];return e.jsxs(J,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:e.jsx("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:b.map((s,r)=>e.jsx("li",{children:e.jsxs("div",{className:"flex items-center",children:[r>0&&e.jsx("span",{className:"mx-2",children:"/"}),s.current?e.jsx("span",{className:"text-gray-500",children:s.label}):e.jsx(R,{to:s.path,className:"text-gray-700 hover:text-blue-600",children:s.label})]})},s.path||r))})})}),e.jsx(F,{type:"new",onFormSubmit:h,onDiscard:y})]})};export{me as default};
