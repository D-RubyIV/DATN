import{aH as O,r as l,at as A,au as y,as as D,bF as $,aI as R,j as e,ax as Q,ay as J,L as T,az as K,aA as x,aB as g,aC as P,dc as w,bM as u,B as p,aE as U}from"./index-D3Ws-_hT.js";const Z=()=>{const M={id:"",discountCode:"",name:"",discountPercent:0,startDate:null,endDate:null,quantityDiscount:0,status:"",productDTOS:[{id:"",code:"",name:""}]},S=O(),[C,N]=l.useState([]),[b,Y]=l.useState(0),[c,k]=l.useState(1),[o,W]=l.useState(5),[v,H]=l.useState([]),L=A().shape({name:y().required("Tên đợt giảm giá là bắt buộc").min(3,"Tên phải có ít nhất 3 ký tự").test("phone-unique","Tên sự kiện đã tồn tại",async t=>!(await D.get("/event/check-name",{params:{name:t}})).data.exists),discountPercent:$().required("Giá trị giảm là bắt buộc").min(1,"Giá trị giảm phải lớn hơn hoặc bằng 1").max(100,"Giá trị giảm không được vượt quá 100"),startDate:y().required("Ngày bắt đầu là bắt buộc"),endDate:y().required("Ngày kết thúc là bắt buộc")});l.useEffect(()=>{E(c,o)},[c,o]);const E=async(t,i)=>{try{const s=await D.get("/event/product-list",{params:{page:t,size:i}});Array.isArray(s.data.content)?(N(s.data.content),Y(s.data.totalElements)):N([])}catch(s){console.error("Error fetching products:",s)}},{openNotification:j}=R(),q=async(t,{resetForm:i,setSubmitting:s})=>{try{const a=v;if(console.log("Ngày bắt đầu (trước khi chuyển đổi):",t.startDate),console.log("Ngày kết thúc (trước khi chuyển đổi):",t.endDate),t.startDate&&t.endDate&&u(t.startDate,"HH:mm DD-MM-YYYY").toDate()>u(t.endDate,"HH:mm DD-MM-YYYY").toDate()){j("Ngày bắt đầu phải trước ngày kết thúc","Thông báo","warning",5e3);return}const n={name:t.name,discountPercent:t.discountPercent,startDate:t.startDate,endDate:t.endDate,productDTOS:a.map(r=>({id:r}))};console.log("Dữ liệu đang gửi lên backend: ",n),(await D.post("/event/save",n)).status===200&&(j("Lưu thành công"),i(),S("/admin/manage/event"))}catch(a){console.error("Lỗi khi lưu sự kiện:",a),a.response?(console.error("Lỗi từ server:",a.response),console.error("Lỗi từ server:",a.response.data),j(`Lỗi khi lưu sự kiện: ${a.response.data.error||a.response.data.message||a.response.data}`,"Thông báo","warning",5e3)):U.error("Lỗi khi kết nối với server")}finally{s(!1)}},I=(t,i)=>{H(s=>i?[...s,t.id]:s.filter(a=>a!==t.id))},z=t=>v.includes(t),B=()=>{c>1&&k(t=>t-1)},F=()=>{c<Math.ceil(b/o)&&k(t=>t+1)};return e.jsx("div",{className:"h-full",children:e.jsx(Q,{initialValues:M,validationSchema:L,enableReinitialize:!0,onSubmit:q,children:({setFieldValue:t,resetForm:i,isSubmitting:s,values:a,errors:n,touched:d})=>e.jsxs(J,{className:"h-full",children:[e.jsx("h1",{className:"font-semibold text-xl mb-4 uppercase",children:"Thêm đợt giảm giá"}),e.jsxs("div",{className:"w-full bg-white p-6 shadow-md rounded-lg h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:[e.jsx("li",{children:e.jsx("div",{className:"flex items-center",children:e.jsx(T,{to:"/",className:"text-gray-700 hover:text-blue-600",children:"Trang Chủ"})})}),e.jsx("li",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx(T,{to:"/manage",className:"text-gray-700 hover:text-blue-600",children:"Quản Lý"})]})}),e.jsx("li",{"aria-current":"page",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("span",{className:"text-gray-500",children:"Thêm đợt giảm giá"})]})})]})})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"w-full lg:w-1/3 bg-white rounded-lg",children:[e.jsx("h4",{className:"font-medium text-xl mb-4",children:"Thông tin đợt giảm giá"}),e.jsxs(K,{children:[e.jsx(x,{asterisk:!0,label:"Tên đợt giảm giá",invalid:!!n.name&&d.name,errorMessage:n.name,children:e.jsx(g,{type:"text",autoComplete:"on",name:"name",style:{height:"44px"},placeholder:"Tên đợt giảm giá...",component:P})}),e.jsx(x,{asterisk:!0,label:"Giá trị giảm(%)",invalid:!!n.discountPercent&&d.discountPercent,errorMessage:n.discountPercent,children:e.jsx(g,{type:"number",autoComplete:"off",name:"discountPercent",style:{height:"44px"},placeholder:"Giá trị giảm(%)...",component:P})}),e.jsx(x,{asterisk:!0,label:"Ngày bắt đầu",invalid:!!n.startDate&&d.startDate,errorMessage:n.startDate,children:e.jsx(g,{name:"startDate",children:({field:r,form:f})=>e.jsx(w,{onChange:m=>{console.log(m);const h=u(m).format("HH:mm DD-MM-YYYY");console.log(h),t("startDate",h)}})})}),e.jsx(x,{asterisk:!0,label:"Ngày kết thúc",invalid:!!n.endDate&&d.endDate,errorMessage:n.endDate,children:e.jsx(g,{name:"endDate",children:({field:r,form:f})=>e.jsx(w,{onChange:m=>{console.log(m);const h=u(m).format("HH:mm DD-MM-YYYY");console.log(h),t("endDate",h)}})})}),e.jsxs(x,{children:[e.jsx(p,{className:"ltr:mr-2 rtl:ml-2",type:"submit",style:{backgroundColor:"#fff",height:"40px"},disabled:s,onClick:()=>i(),children:"Tải lại"}),e.jsx(p,{variant:"solid",type:"submit",style:{backgroundColor:"rgb(79, 70, 229)",height:"40px"},disabled:s,children:"Thêm mới"})]})]})]}),e.jsxs("div",{className:"w-full lg:w-2/3 bg-white rounded-lg",children:[e.jsx("h4",{className:"font-medium text-xl mb-4",children:"Danh sách sản phẩm"}),e.jsxs("table",{className:"table-auto w-full border border-collapse border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Chọn"}),e.jsx("th",{className:"border px-4 py-2",children:"Mã sản phẩm"}),e.jsx("th",{className:"border px-4 py-2",children:"Tên sản phẩm"})]})}),e.jsx("tbody",{children:C.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:z(r.id),onChange:f=>I(r,f.target.checked)})}),e.jsx("td",{className:"border px-4 py-2",children:r.code}),e.jsx("td",{className:"border px-4 py-2",children:r.name})]},r.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(p,{type:"button",disabled:c===1,onClick:B,children:"Trang trước"}),e.jsxs("span",{children:["Trang ",c," / ",Math.ceil(b/o)]}),e.jsx(p,{type:"button",disabled:c>=Math.ceil(b/o),onClick:F,children:"Trang sau"})]})]})]})]})]})})})};export{Z as default};
