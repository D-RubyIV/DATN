import{at as y,au as o,r as m,j as e,av as F,aw as b,ax as M,ay as S,az as k,aA as h,aB as p,aC as u,B as N,aD as f,aE as c}from"./index-D4RF4o2o.js";import{r as E}from"./ClassicLayout-D6RkHwe2.js";const q=y().shape({email:o().required("Please enter your email").email("Invalid email address"),verificationCode:o().when("emailSent",{is:!0,then:o().required("Please enter the verification code")}),newPassword:o().when("emailSent",{is:!0,then:o().required("Please enter your new password").min(6,"Password must be at least 6 characters")})}),B=({disableSubmit:I=!1,signInUrl:j="/auth/sign-in"})=>{const[l,g]=m.useState(!1),[w,x]=m.useState(null),[d,v]=m.useState(!1),P=async(a,s)=>{var r,n;s(!0);try{(await f.post("http://localhost:8080/api/v1/users/request-verification-code",{email:a.email})).status===200&&(g(!0),v(!0),c.success("Mã xác minh đã được gửi đến email của bạn"))}catch(i){const t=((n=(r=i.response)==null?void 0:r.data)==null?void 0:n.message)||i.message||"Có lỗi xảy ra!";x(t),c.error(t)}s(!1)},C=async(a,s)=>{var r,n;s(!0);try{(await f.post("http://localhost:8080/api/v1/users/reset-password/v2",{email:a.email,verificationCode:a.verificationCode,newPassword:a.newPassword})).status===200&&c.success("Mật khẩu của bạn đã được đặt lại thành công")}catch(i){const t=((n=(r=i.response)==null?void 0:r.data)==null?void 0:n.message)||i.message||"Có lỗi xảy ra!";x(t),c.error(t)}s(!1)};return e.jsxs("div",{className:"forgot-password-form",children:[e.jsx(F,{}),e.jsx("div",{className:"mb-6",children:l?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mb-1",children:"Kiểm tra email của bạn"}),e.jsx("p",{children:"Chúng tôi đã gửi hướng dẫn khôi phục mật khẩu tới email của bạn"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mb-1",children:"Quên mật khẩu"}),e.jsx("p",{children:"Vui lòng nhập địa chỉ email của bạn để nhận mã xác minh"})]})}),w&&e.jsx(b,{showIcon:!0,className:"mb-4",type:"danger",children:w}),e.jsx(M,{initialValues:{email:"",verificationCode:"",newPassword:""},validationSchema:q,onSubmit:(a,{setSubmitting:s})=>{l?d?C(a,s):s(!1):P(a,s)},children:({touched:a,errors:s,isSubmitting:r,setFieldValue:n})=>e.jsx(S,{children:e.jsxs(k,{children:[!l&&!d&&e.jsx(h,{invalid:s.email&&a.email,errorMessage:s.email,children:e.jsx(p,{type:"email",autoComplete:"off",name:"email",placeholder:"Email",component:u})}),d&&e.jsxs(e.Fragment,{children:[e.jsx(h,{invalid:s.verificationCode&&a.verificationCode,errorMessage:s.verificationCode,children:e.jsx(p,{type:"text",name:"verificationCode",placeholder:"Verification Code",component:u})}),e.jsx(h,{invalid:s.newPassword&&a.newPassword,errorMessage:s.newPassword,children:e.jsx(p,{type:"password",name:"newPassword",placeholder:"New Password",component:u})})]}),e.jsx(N,{block:!0,loading:r,variant:"solid",type:"submit",children:l?"Xác nhận":"Gửi Email"}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("span",{children:"Quay lại "}),e.jsx(E,{to:j,children:"Đăng nhập"})]})]})})})]})},Q=()=>e.jsx(B,{disableSubmit:!1});export{Q as default};
