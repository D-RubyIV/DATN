import{cS as k,cT as he,bW as We,bY as Ze,cd as me,n as B,r as p,j as a,aO as we,aA as $,aC as pe,cZ as Fe,B as H,aE as G,aB as ue,ci as Oe,cW as Je,cV as ea,cX as Ee,b7 as aa,cY as ta,bt as sa,ak as la,br as na,bx as $e,bo as ra,bE as ia,at as z,bF as Ce,ch as Ie,ax as oa,ay as ca,az as da,aH as ua,cn as ze,co as Me}from"./index-BTLFdfuL.js";import{S as ha}from"./StickyFooter-DYUtiZSQ.js";import{h as Te}from"./ClassicLayout-xSv5pNfR.js";import{h as ma,i as pa,j as ga,k as ba,l as xa,m as fa,n as ya,o as Ca,p as ja,q as va,r as Sa,s as Da,E as Aa,t as Na,u as ka,v as Pa,w as wa,x as Ta,y as Ea,z as Ia,A as za,B as Ma,C as Ra,D as Ka,F as Va}from"./ProductSalesService-Da2K958o.js";import{C as Be}from"./react-select-creatable.esm-BszG6AWE.js";import{a as qa}from"./index.esm-BYSg5Yzi.js";import{D as Ne}from"./DoubleSidedImage-CTHkeOs3.js";import{A as Fa}from"./index.esm-BSGz3App.js";const Le="addAttribute",Ue="addProduct",Q=k(`${Le}/addAttribute`,async({AttributeData:t,apiFunc:e})=>{const s=await e(t);if(!s||!s.data)throw new Error("Invalid response from API");return s.data}),W=k(`${Ue}/addProduct`,async({ProductData:t,apiFunc:e})=>{const s=await e(t);if(!s||!s.data)throw new Error("Invalid response from API");return s.data}),Oa={loading:!1,addAttribute:!1,dataAttribute:null,labelAttribute:"",nameAttribute:"",options:[]},$a={loading:!1,addProduct:!1,dataProduct:null,nameProduct:"",options:[]},Ge=he({name:Le,initialState:Oa,reducers:{setAttributeData:(t,e)=>{t.dataAttribute=e.payload},toggleAddAttributeConfirmation:(t,e)=>{t.addAttribute=e.payload},setLabelAttribute:(t,e)=>{t.labelAttribute=e.payload},setNameAttribute:(t,e)=>{t.nameAttribute=e.payload}},extraReducers:t=>{t.addCase(Q.fulfilled,(e,s)=>{e.loading=!1,e.dataAttribute=s.payload,e.addAttribute=!1,e.options.push(s.payload)}).addCase(Q.pending,e=>{e.loading=!0}).addCase(Q.rejected,e=>{e.loading=!1})}}),He=he({name:Ue,initialState:$a,reducers:{setNameProduct:(t,e)=>{t.nameProduct=e.payload},setProductData:(t,e)=>{t.dataProduct=e.payload},toggleAddProductConfirmation:(t,e)=>{t.addProduct=e.payload}},extraReducers:t=>{t.addCase(W.fulfilled,(e,s)=>{e.loading=!1,e.dataProduct=s.payload,e.addProduct=!1,e.options.push(s.payload)}).addCase(W.pending,e=>{e.loading=!0}).addCase(W.rejected,e=>{e.loading=!1})}}),{setAttributeData:Ba,toggleAddAttributeConfirmation:ke,setLabelAttribute:La,setNameAttribute:Ua}=Ge.actions,{setProductData:Nt,toggleAddProductConfirmation:Pe,setNameProduct:Ga}=He.actions,Re={attributeReducer:Ge.reducer,productReducer:He.reducer},T="optionList",Z=k(T+"/getBrandData",async()=>(await ma()).data),J=k(T+"/getOriginData",async()=>(await pa()).data),ee=k(T+"/getStyleData",async()=>(await ga()).data),ae=k(T+"/getCollarData",async()=>(await ba()).data),te=k(T+"/getSleeveData",async()=>(await xa()).data),se=k(T+"/getThicknessData",async()=>(await fa()).data),le=k(T+"/getTextureData",async()=>(await ya()).data),ne=k(T+"/getElasticityData",async()=>(await Ca()).data),re=k(T+"/getColorData",async()=>(await ja()).data),ie=k(T+"/getSizeData",async()=>(await va()).data),oe=k(T+"/getMaterialData",async()=>(await Sa()).data),ce=k(T+"/getProductData",async()=>(await Da()).data),Ha={loading:!0,brandData:[],originData:[],styleData:[],collarData:[],sleeveData:[],thicknessData:[],textureData:[],elasticityData:[],colorData:[],sizeData:[],materialData:[],productData:[]},Xa=he({name:`${T}/state`,initialState:Ha,reducers:{},extraReducers:t=>{t.addCase(Z.fulfilled,(e,s)=>{e.brandData=s.payload.data,e.loading=!1}).addCase(Z.pending,e=>{e.loading=!0}).addCase(Z.rejected,e=>{e.loading=!1}).addCase(J.fulfilled,(e,s)=>{e.originData=s.payload.data,e.loading=!1}).addCase(J.pending,e=>{e.loading=!0}).addCase(J.rejected,e=>{e.loading=!1}).addCase(ee.fulfilled,(e,s)=>{e.styleData=s.payload.data,e.loading=!1}).addCase(ee.pending,e=>{e.loading=!0}).addCase(ee.rejected,e=>{e.loading=!1}).addCase(ae.fulfilled,(e,s)=>{e.collarData=s.payload.data,e.loading=!1}).addCase(ae.pending,e=>{e.loading=!0}).addCase(ae.rejected,e=>{e.loading=!1}).addCase(te.fulfilled,(e,s)=>{e.sleeveData=s.payload.data,e.loading=!1}).addCase(te.pending,e=>{e.loading=!0}).addCase(te.rejected,e=>{e.loading=!1}).addCase(se.fulfilled,(e,s)=>{e.thicknessData=s.payload.data,e.loading=!1}).addCase(se.pending,e=>{e.loading=!0}).addCase(se.rejected,e=>{e.loading=!1}).addCase(le.fulfilled,(e,s)=>{e.textureData=s.payload.data,e.loading=!1}).addCase(le.pending,e=>{e.loading=!0}).addCase(le.rejected,e=>{e.loading=!1}).addCase(ne.fulfilled,(e,s)=>{e.elasticityData=s.payload.data,e.loading=!1}).addCase(ne.pending,e=>{e.loading=!0}).addCase(ne.rejected,e=>{e.loading=!1}).addCase(re.fulfilled,(e,s)=>{e.colorData=s.payload.data,e.loading=!1}).addCase(re.pending,e=>{e.loading=!0}).addCase(re.rejected,e=>{e.loading=!1}).addCase(ie.fulfilled,(e,s)=>{e.sizeData=s.payload.data,e.loading=!1}).addCase(ie.pending,e=>{e.loading=!0}).addCase(ie.rejected,e=>{e.loading=!1}).addCase(oe.fulfilled,(e,s)=>{e.materialData=s.payload.data,e.loading=!1}).addCase(oe.pending,e=>{e.loading=!0}).addCase(oe.rejected,e=>{e.loading=!1}).addCase(ce.fulfilled,(e,s)=>{e.productData=s.payload.data,e.loading=!1}).addCase(ce.pending,e=>{e.loading=!0}).addCase(ce.rejected,e=>{e.loading=!1})}}),_a=Xa.reducer,Ya="dataDetailedProduct",Qa={data:[]},Xe=he({name:Ya,initialState:Qa,reducers:{setCombinations:(t,e)=>{t.data=e.payload},removeCombination:(t,e)=>{t.data=t.data.filter(s=>s.code!==e.payload)},updateCombination:(t,e)=>{const s=t.data.findIndex(d=>d.code===e.payload.code);if(s!==-1){const d={...t.data[s],...e.payload};t.data[s]=d}},updateProductImagesByColor:(t,e)=>{const{colorName:s,images:d}=e.payload;t.data=t.data.map(l=>{var n;return((n=l.color)==null?void 0:n.name)===s?{...l,images:d}:l})}}}),{setCombinations:je,removeCombination:Wa,updateCombination:Za,updateProductImagesByColor:Ke}=Xe.actions,Ja=Xe.reducer,ge=We({attributeAdd:Re.attributeReducer,productAdd:Re.productReducer,options:_a,detailedProduct:Ja}),O=Ze;me("addProduct",ge);const et=({setFieldValue:t,updateOptions:e})=>{const s=B(),{nameProduct:d,addProduct:l}=O(C=>({nameProduct:C.addProduct.productAdd.nameProduct,addProduct:C.addProduct.productAdd.addProduct})),[n,u]=p.useState(""),[f,y]=p.useState(""),[g,c]=p.useState(null),[r,o]=p.useState(null),[i,j]=p.useState(!1);p.useEffect(()=>{d&&u(d||"")},[d]);const K=C=>{const I=C.target.value;u(I),I.trim()&&c(null)},M=C=>{y(C),C.trim()&&o(null)},R=C=>{s(Pe(!1)),E()},E=()=>{u(""),y(""),c(null),o(null)},L=()=>{const C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:5},()=>C.charAt(Math.floor(Math.random()*C.length))).join("")},D=(C,I)=>({id:Math.floor(Math.random()*1e3),code:L(),name:C,description:I,deleted:!1,createdDate:new Date().toISOString(),modifiedDate:new Date().toISOString()}),X=async()=>{if(i)return;j(!0);let C=!1;if(n.trim()?c(null):(c("Tên sản phẩm không được để trống"),C=!0),f.trim()?o(null):(o("Mô tả sản phẩm không được để trống"),C=!0),C){j(!1);return}const I=D(n,f);try{const V=await s(W({ProductData:I,apiFunc:Aa}));if(W.fulfilled.match(V)){const P=V.payload,q={id:P.id,code:P.code,name:P.name,description:P.description,deleted:!1,createdDate:P.createdDate||new Date().toISOString(),modifiedDate:P.modifiedDate||new Date().toISOString()};t("product",q),e("product",q),t("description",q.description),G.success(`Thành công thêm sản phẩm ${q.name}.`)}}catch(V){const P=V instanceof Error?V.message:"Đã xảy ra lỗi không xác định!!!";G.error(` ${P}`)}finally{j(!1),E(),s(Pe(!1))}};return a.jsxs(we,{isOpen:l,onClose:R,shouldCloseOnEsc:!1,shouldCloseOnOverlayClick:!1,onRequestClose:R,children:[a.jsx("h5",{className:"mb-4",children:"Thêm nhanh sản phẩm"}),a.jsxs($,{label:"Tên sản phẩm",children:[a.jsx(pe,{value:n||"",onChange:K,className:g?"border-red-500":""}),g&&a.jsx("p",{className:"text-red-500",children:g})]}),a.jsxs($,{label:"Mô tả sản phẩm",labelClass:"!justify-start",children:[a.jsx(Fe,{value:f,onChange:M,style:{border:r?"1px solid red":"none"}}),r&&a.jsx("p",{className:"text-red-500",children:r})]}),a.jsxs("div",{className:"text-right mt-6",children:[a.jsx(H,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:R,children:"Hủy bỏ"}),a.jsx(H,{style:{backgroundColor:"rgb(79, 70, 229)",height:"40px"},variant:"solid",onClick:X,disabled:i,children:"Xác nhận"})]})]})},at=({touched:t,errors:e,values:s,setFieldValue:d,data:l})=>{const n=B(),[u,f]=p.useState((l==null?void 0:l.products)||[]);p.useEffect(()=>{console.log(u)},[u]),p.useEffect(()=>{l&&f(l.products||[])},[l]);const y=c=>{n(Pe(!0)),n(Ga(c))},g=(c,r)=>{if(c==="product"){const o={label:r.name,value:r};f(i=>[o,...i])}};return a.jsxs(Te,{divider:!0,className:"mb-4",children:[a.jsx("h5",{children:"Thông tin cơ bản"}),a.jsx($,{label:"Tên sản phẩm",invalid:!!(e.product&&t.product),errorMessage:e.product,children:a.jsx(ue,{name:"product",children:({field:c,form:r})=>a.jsx(Oe,{isClearable:!0,componentAs:Be,onCreateOption:y,field:c,form:r,options:u,value:s.product?u.find(o=>{var i;return o.value.id===((i=s.product)==null?void 0:i.id)}):null,onChange:o=>{o?(r.setFieldValue(c.name,o.value),r.setFieldValue("description",o.value.description)):r.setFieldValue(c.name,null)},placeholder:"Tên sản phẩm...",formatCreateLabel:o=>`Thêm nhanh "${o}"`})})}),a.jsx($,{label:"Mô tả sản phẩm",labelClass:"!justify-start",invalid:!!(e.description&&t.description),errorMessage:e.description,children:a.jsx(ue,{name:"description",children:({field:c,form:r})=>a.jsx(Fe,{value:c.value,onChange:o=>r.setFieldValue(c.name,o),readOnly:!0})})}),a.jsx(et,{setFieldValue:d,updateOptions:g,touched:t,errors:e,values:s})]})};me("addAttribute",ge);const tt=({setFieldValue:t,updateOptions:e,...s})=>{const d=B(),{dataAttribute:l,labelAttribute:n,nameAttribute:u,addAttribute:f}=O(c=>({dataAttribute:c.addAttribute.attributeAdd.dataAttribute,labelAttribute:c.addAttribute.attributeAdd.labelAttribute,nameAttribute:c.addAttribute.attributeAdd.nameAttribute,addAttribute:c.addAttribute.attributeAdd.addAttribute})),y=c=>{d(ke(!1))},g=async()=>{let c;switch(u){case"brand":c=Ka;break;case"origin":c=Ra;break;case"style":c=Ma;break;case"material":c=za;break;case"collar":c=Ia;break;case"sleeve":c=Ea;break;case"texture":c=Ta;break;case"thickness":c=wa;break;case"elasticity":c=Pa;break;case"size":c=ka;break;case"color":c=Na;break;default:G.error("Không có chức năng API cho thuộc tính này!!");return}if(!l){G.error("Không có dữ liệu thuộc tính để thêm!!");return}try{const r=await d(Q({AttributeData:l,apiFunc:c}));if(Q.fulfilled.match(r)){const o=r.payload,i={id:o.id,code:o.code,name:o.name,deleted:!1},j=u==="brand"||u==="origin"||u==="style"||u==="material"||u==="collar"||u==="sleeve"||u==="texture"||u==="thickness"||u==="elasticity"?u:u==="size"?"size":"color";if(u==="size"||u==="color"){const M=[...s.values[u]||[],i];t(j,M)}else t(j,i);e(j,i),G.success(` Thành công thêm  ${n}  ${i.name}.`)}else throw new Error("Failed to add attribute")}catch(r){const o=r instanceof Error?r.message:"Đã xảy ra lỗi không xác định!!!";G.error(` ${o}`)}finally{d(ke(!1))}};return a.jsxs(we,{isOpen:f,onClose:y,onRequestClose:y,shouldCloseOnEsc:!1,shouldCloseOnOverlayClick:!1,children:[a.jsxs("h5",{className:"mb-4",children:["Thêm nhanh ",n]}),a.jsx($,{label:`Tên ${n}`,children:a.jsx(pe,{placeholder:(l==null?void 0:l.name)||"",disabled:!0})}),a.jsxs("div",{className:"text-right mt-6",children:[a.jsx(H,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:y,children:"Hủy bỏ"}),a.jsx(H,{style:{backgroundColor:"rgb(79, 70, 229)",height:"40px"},variant:"solid",onClick:g,children:"Xác nhận"})]})]})},{MultiValueLabel:st}=ea,lt=({innerProps:t,label:e,data:s,isSelected:d})=>a.jsxs("div",{className:`flex items-center justify-between p-2 ${d?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...t,children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:s.value.name}}),a.jsx("span",{className:"ml-2 rtl:mr-2",children:e})]}),d&&a.jsx(Je,{style:{color:"rgb(79, 70, 229)"},className:"text-xl"})]}),nt=({children:t,...e})=>{const{data:s}=e;return a.jsx(st,{...e,children:a.jsxs("div",{className:"inline-flex items-center",children:[a.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:s.value.name}}),a.jsx("span",{className:"ml-1 rtl:mr-2",children:t})]})})},rt=({touched:t,errors:e,values:s,setFieldValue:d,data:l})=>{const n=B();O(m=>m.addAttribute.attributeAdd.addAttribute);const[u,f]=p.useState((l==null?void 0:l.brands)||[]),[y,g]=p.useState((l==null?void 0:l.origins)||[]),[c,r]=p.useState((l==null?void 0:l.styles)||[]),[o,i]=p.useState((l==null?void 0:l.materials)||[]),[j,K]=p.useState((l==null?void 0:l.collars)||[]),[M,R]=p.useState((l==null?void 0:l.sleeves)||[]),[E,L]=p.useState((l==null?void 0:l.textures)||[]),[D,X]=p.useState((l==null?void 0:l.thicknesses)||[]),[C,I]=p.useState((l==null?void 0:l.elasticities)||[]),[V,P]=p.useState((l==null?void 0:l.sizes)||[]),[q,de]=p.useState((l==null?void 0:l.colors)||[]);p.useEffect(()=>{l&&(f(l.brands||[]),g(l.origins||[]),r(l.styles||[]),i(l.materials||[]),K(l.collars||[]),R(l.sleeves||[]),L(l.textures||[]),X(l.thicknesses||[]),I(l.elasticities||[]),P(l.sizes||[]),de(l.colors||[]))},[l]);const h=()=>{const m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:5},()=>m.charAt(Math.floor(Math.random()*m.length))).join("")},A=m=>({id:Math.floor(Math.random()*1e3),code:h(),name:m,deleted:!1}),v=(m,x,b)=>{const F=A(m);n(Ba(F)),n(La(x)),n(Ua(b)),n(ke(!0))},N=(m,x,b,F=!1,Ye)=>a.jsx($,{label:x,invalid:!!(e[m]&&t[m]),errorMessage:e[m],children:a.jsx(ue,{name:m,children:({field:be,form:U})=>{const _=s[m],xe=F&&Array.isArray(_)?b.filter(w=>_.some(ye=>ye.id===w.value.id)):_&&"id"in _?[b.find(w=>w.value.id===_.id)||null]:[],fe=F?xe.filter(w=>w!==null):xe.length>0?xe[0]:null,Y=m!=="color"&&m!=="size"&&b.length>0?b[0]:void 0;return p.useEffect(()=>{fe===null&&Y&&U.setFieldValue(m,F?[Y.value]:Y.value),console.log("moi chon")},[fe,Y,U,m,F,l]),a.jsx(Oe,{isClearable:!0,componentAs:Be,isMulti:F,components:{Option:lt,MultiValueLabel:nt},onCreateOption:w=>v(w,x,m),field:be,form:U,options:b,value:fe||Y,onChange:w=>{if(F){const ye=w.map(Qe=>Qe.value);U.setFieldValue(be.name,ye)}else U.setFieldValue(be.name,w?w.value:null),console.log(U.values)},placeholder:`Chọn ${x.toLowerCase()}...`,formatCreateLabel:w=>`Thêm nhanh "${w}"`,closeMenuOnSelect:Ye})}})});return a.jsxs(Te,{divider:!0,isLastChild:!0,className:"mb-4",children:[a.jsx("h5",{children:"Thuộc tính"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[" ",a.jsxs("div",{className:"col-span-1",children:[N("brand","Thương hiệu",u)," "]}),a.jsxs("div",{className:"col-span-1",children:[N("origin","Xuất xứ",y)," "]}),a.jsx("div",{className:"col-span-1",children:N("style","Kiểu dáng",c)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[" ",a.jsx("div",{className:"col-span-1",children:N("material","Chất liệu",o)}),a.jsx("div",{className:"col-span-1",children:N("collar","Kiểu cổ áo",j)}),a.jsx("div",{className:"col-span-1",children:N("sleeve","KIểu tay áo",M)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[" ",a.jsx("div",{className:"col-span-1",children:N("texture","Kết cấu",E)}),a.jsx("div",{className:"col-span-1",children:N("thickness","Độ dày",D)}),a.jsx("div",{className:"col-span-1",children:N("elasticity","Độ co giãn",C)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[" ",a.jsx("div",{className:"col-span-1",children:a.jsx($,{label:"Khối lượng",invalid:!!(e.mass&&t.mass),errorMessage:e.mass,children:a.jsx(ue,{type:"text",autoComplete:"off",name:"mass",placeholder:"Hãy điền khối lượng...",component:pe,suffix:"gm"})})}),a.jsx("div",{className:"col-span-1",children:N("color","Màu sắc",q,!0,!1)}),a.jsx("div",{className:"col-span-1",children:N("size","Kích thước",V,!0,!1)})]}),a.jsx(tt,{setFieldValue:d,updateOptions:(m,x)=>{m==="brand"?f(b=>[{label:x.name,value:x},...b]):m==="origin"?g(b=>[{label:x.name,value:x},...b]):m==="size"?P(b=>[{label:x.name,value:x},...b]):m==="color"?de(b=>[{label:x.name,value:x},...b]):m==="style"?r(b=>[{label:x.name,value:x},...b]):m==="material"?i(b=>[{label:x.name,value:x},...b]):m==="collar"?K(b=>[{label:x.name,value:x},...b]):m==="sleeve"?R(b=>[{label:x.name,value:x},...b]):m==="texture"?L(b=>[{label:x.name,value:x},...b]):m==="thickness"?X(b=>[{label:x.name,value:x},...b]):m==="elasticity"&&I(b=>[{label:x.name,value:x},...b])},touched:t,errors:e,values:s})]})},it=({imgList:t,onImageDelete:e})=>{const[s,d]=p.useState(null),[l,n]=p.useState(!1),[u,f]=p.useState(!1),y=i=>{d(i),n(!0)},g=()=>{n(!1),setTimeout(()=>d(null),300)},c=i=>{d(i),f(!0)},r=()=>{d(null),f(!1)},o=()=>{s&&e(s),f(!1)};return a.jsxs(a.Fragment,{children:[t.map(i=>a.jsxs("div",{className:"group relative rounded border p-2 flex justify-center items-center",children:[a.jsx("img",{className:"rounded object-cover max-h-[120px] max-w-full",src:i.url,alt:i.url}),a.jsxs("div",{className:"absolute inset-2 bg-gray-900/[.7] group-hover:flex hidden text-xl items-center justify-center",children:[a.jsx("span",{className:"text-gray-100 hover:text-gray-300 cursor-pointer p-1.5",onClick:()=>y(i),children:a.jsx(aa,{})}),a.jsx("span",{className:"text-gray-100 hover:text-gray-300 cursor-pointer p-1.5",onClick:()=>c(i),children:a.jsx(ta,{})})]})]},i.id)),a.jsxs(we,{isOpen:l,onClose:g,onRequestClose:g,children:[a.jsx("h5",{className:"mb-4",children:s==null?void 0:s.code}),a.jsx("img",{className:"w-full",src:s==null?void 0:s.url,alt:s==null?void 0:s.url})]}),a.jsx(sa,{isOpen:u,type:"danger",title:"Xóa ảnh",cancelText:"HỦY",confirmText:"XÁC NHẬN",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:o,children:a.jsx("p",{children:"Bạn có chắc chắn muốn xóa hình ảnh này không? "})})]})},ot=({colorName:t})=>{var c;const e=B(),l=((c=O(r=>r.dataDetailedProduct.detailedProduct.data).filter(r=>{var o;return((o=r.color)==null?void 0:o.name)===t})[0])==null?void 0:c.images)??[],[n,u]=p.useState(!1),f=r=>{const o=["image/jpeg","image/png"];if(r)for(const j of r){if(!o.includes(j.type))return"Vui lòng tải lên tệp .jpeg hoặc .png!";if(j.size>=5e5)return"Tải lên hình ảnh không được vượt quá 500KB!"}return!0},y=async r=>{if(!r||r.length===0)return;u(!0);const o=r[r.length-1];if(!o)return;const i=new FormData;i.append("file",o);try{const j=await fetch(`${la.apiPrefix}/image/upload`,{method:"POST",body:i});if(!j.ok)throw new Error("Không tải được hình ảnh lên");const K=await j.text(),M={id:Date.now(),code:o.name,url:K,deleted:!1,createdDate:new Date().toISOString(),modifiedDate:new Date().toISOString()},R=[...l.filter(E=>!E.deleted),...l.some(E=>E.code===M.code&&!E.deleted)?[]:[M]];e(Ke({colorName:t,images:R}))}catch(j){console.error("Error uploading image:",j)}finally{u(!1)}},g=r=>{const o=l.filter(i=>i.id!==r.id);e(Ke({colorName:t,images:o}))};return a.jsx("div",{className:"mb-4 grid",children:a.jsxs("div",{className:"text-center",children:[a.jsxs("h5",{className:"mb-3",children:["Thêm ảnh cho sản phẩm màu ",t," "]}),l.length>0?a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 xl:grid-cols-4 gap-4",children:[a.jsx(it,{imgList:l,onImageDelete:g}),a.jsx(Ee,{draggable:!0,beforeUpload:f,showList:!1,onChange:r=>y(r),children:a.jsxs("div",{className:"max-w-full flex flex-col px-4 py-2 justify-center items-center",children:[a.jsx(Ne,{src:"/img/others/upload.png",darkModeSrc:"/img/others/upload-dark.png"}),n?a.jsx("div",{className:"mt-4",children:"Đang tải..."}):a.jsx("p",{className:"font-semibold text-center text-gray-800 dark:text-white",children:"Tải lên "})]})})]}):a.jsx(Ee,{draggable:!0,beforeUpload:f,showList:!1,onChange:r=>y(r),children:a.jsxs("div",{className:" text-center",children:[a.jsx(Ne,{className:"mx-auto",src:"/img/others/upload.png",darkModeSrc:"/img/others/upload-dark.png"}),n?a.jsx("div",{className:"mt-4",children:"Đang tải..."}):a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"font-semibold",children:[a.jsxs("span",{className:"text-gray-800 dark:text-white",children:["Thả hình ảnh của bạn ở đây, hoặc"," "]}),a.jsx("span",{className:"text-blue-500",children:"duyệt"})]}),a.jsx("p",{className:"mt-1 opacity-60 dark:text-white",children:"Hỗ trợ: jpeg, png"})]})]})})]})})},{Tr:Ve,Th:ve,Td:Se,THead:ct,TBody:dt}=$e,De=({getValue:t,productCode:e,column:s,table:d})=>{const l=t(),[n,u]=p.useState(l),[f,y]=p.useState(!1),g=o=>/^[0-9]*$/.test(o)||o==="",c=o=>{const i=o.value;u(i),g(i)?y(!1):y(!0)},r=()=>{const o=d.options.meta;if(o){const i=typeof n=="string"&&!isNaN(Number(n))?Number(n):n;g(i.toString())?(y(!1),i!==""&&i!==void 0?(console.log(`Updating ${s.id} to ${i} for product ${e}`),o.updateData(e,s.accessorKey,i)):console.warn(`Invalid value for ${s.id} for product ${e}:`,i)):(y(!0),u(""))}};return p.useEffect(()=>{u(l)},[l]),a.jsx("div",{children:a.jsx(ra,{value:n,onValueChange:c,onBlur:r,thousandSeparator:!1,allowNegative:!1,customInput:pe,"aria-label":`Edit ${s.id}`,className:f?"border-red-500":""})})},ut=({productCombinations:t,errors:e,touched:s})=>{const d=B(),l=p.useMemo(()=>[{header:"Kích thước",accessorKey:"size.name"},{header:"Giá",accessorKey:"price",cell:De},{header:"Số lượng",accessorKey:"quantity",cell:De}],[]),n=p.useCallback((g,c,r)=>{const o=t.find(i=>i.code===g);if(o){const i={...o,[c]:r};console.log("Updating Product:",i),typeof i.price=="number"&&i.price>=0&&typeof i.quantity=="number"&&i.quantity>=0?d(Za(i)):console.error("Invalid update: Price or Quantity is invalid:",i)}},[d,t]),u=na({data:t,columns:l,getCoreRowModel:ia(),meta:{updateData:n}}),f=g=>{window.confirm("Bạn có chắc chắn muốn xóa sản phẩm này không?")&&d(Wa(g))},y=p.useMemo(()=>t.reduce((g,c)=>{var o;const r=((o=c.color)==null?void 0:o.name)||"Unknown";return g[r]||(g[r]=[]),g[r].push(c),g},{}),[t]);return a.jsx(a.Fragment,{children:Object.entries(y).map(([g,c])=>a.jsxs(Te,{children:[a.jsxs("h2",{className:"font-bold text-xl",children:["Sản Phẩm Chi Tiết Màu ",g]}),a.jsxs($e,{children:[a.jsx(ct,{children:a.jsxs(Ve,{children:[a.jsx(ve,{children:"#"}),l.map(r=>a.jsx(ve,{children:r.header},r.accessorKey)),a.jsx(ve,{})]})}),a.jsx(dt,{children:c.map((r,o)=>a.jsxs(Ve,{children:[a.jsx(Se,{children:o+1}),l.map(i=>a.jsx(Se,{children:i.accessorKey==="price"||i.accessorKey==="quantity"?a.jsx(De,{getValue:()=>r[i.accessorKey],productCode:r.code,column:i,table:u,invalid:!!(e[i.accessorKey]&&s[i.accessorKey]),errorMessage:e[i.accessorKey]}):a.jsx("span",{children:i.accessorKey==="size.name"?r.size.name:r[i.accessorKey]})},`${r.code}-${i.accessorKey}`)),a.jsx(Se,{children:a.jsx("button",{type:"button",onClick:()=>f(r.code),className:"text-red-400 hover:text-red-600","aria-label":`Xóa sản phẩm với mã ${r.code}`,children:a.jsx(qa,{size:23})})})]},r.code))})]}),a.jsx("div",{className:"lg:col-span-1",children:a.jsx(ot,{colorName:g})})]},g))})},S=[];for(let t=0;t<256;++t)S.push((t+256).toString(16).slice(1));function ht(t,e=0){return(S[t[e+0]]+S[t[e+1]]+S[t[e+2]]+S[t[e+3]]+"-"+S[t[e+4]]+S[t[e+5]]+"-"+S[t[e+6]]+S[t[e+7]]+"-"+S[t[e+8]]+S[t[e+9]]+"-"+S[t[e+10]]+S[t[e+11]]+S[t[e+12]]+S[t[e+13]]+S[t[e+14]]+S[t[e+15]]).toLowerCase()}let Ae;const mt=new Uint8Array(16);function pt(){if(!Ae){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ae=crypto.getRandomValues.bind(crypto)}return Ae(mt)}const gt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qe={randomUUID:gt};function bt(t,e,s){if(qe.randomUUID&&!e&&!t)return qe.randomUUID();t=t||{};const d=t.random||(t.rng||pt)();return d[6]=d[6]&15|64,d[8]=d[8]&63|128,ht(d)}me("optionList",ge);me("dataDetailedProduct",ge);const xt=z().shape({product:z().nullable().required("Tên sản phẩm là bắt buộc!"),brand:z().nullable().required("Thương hiệu là bắt buộc!"),origin:z().nullable().required("Xuất xứ là bắt buộc!"),style:z().nullable().required("Kiểu dáng là bắt buộc!"),material:z().nullable().required("Chất liệu là bắt buộc!"),collar:z().nullable().required("Kiểu cổ áo là bắt buộc!"),sleeve:z().nullable().required("Kiểu tay áo là bắt buộc!"),texture:z().nullable().required("Kết cấu vải là bắt buộc!"),thickness:z().nullable().required("Độ dày vải là bắt buộc!"),elasticity:z().nullable().required("Độ đàn hồi vải là bắt buộc!"),mass:Ce().required("Khối lượng là bắt buộc!").typeError("Khối lượng phải là số!").positive("Khối lượng phải là số dương!"),price:Ce().required("giá là bắt buộc!").typeError("giá phải là số!").positive("giá phải là số dương!"),quantity:Ce().required("Số lượng là bắt buộc!").typeError("Số lượng  phải là số!").positive("Số lượng phải là số dương!"),color:Ie().nullable().required("Màu sắc là bắt buộc!").min(1,"Cần chọn ít nhất một màu sắc!"),size:Ie().nullable().required("Kích thước là bắt buộc!").min(1,"Cần chọn ít nhất một kích thước!")}),_e=p.forwardRef((t,e)=>{const{initialData:s={id:0,name:"",code:"",product:null,size:[],color:[],brand:null,collar:null,elasticity:null,material:null,origin:null,sleeve:null,style:null,texture:null,thickness:null,mass:500,price:1e5,quantity:40,description:""},onFormSubmit:d,onDiscard:l}=t,n=B();p.useEffect(()=>{u()},[]);const u=()=>{n(ce()),n(Z()),n(J()),n(ee()),n(ae()),n(te()),n(se()),n(le()),n(ne()),n(re()),n(ie()),n(oe())},{productData:f,brandData:y,originData:g,styleData:c,collarData:r,sleeveData:o,thicknessData:i,textureData:j,elasticityData:K,colorData:M,sizeData:R,materialData:E}=O(h=>h.optionList.options),L=O(h=>h.dataDetailedProduct.detailedProduct);p.useEffect(()=>{n(ce()),n(Z()),n(J()),n(ee()),n(ae()),n(te()),n(se()),n(le()),n(ne()),n(re()),n(ie()),n(oe())},[L]);const D=h=>(h==null?void 0:h.map(A=>({label:A.name,value:A})))||[],C={products:(h=>(h==null?void 0:h.map(A=>({label:A.name,value:A})))||[])(f),brands:D(y),origins:D(g),styles:D(c),collars:D(r),sleeves:D(o),thicknesses:D(i),textures:D(j),elasticities:D(K),colors:D(M),sizes:D(R),materials:D(E)},I=()=>bt();let V=0;const P=()=>++V,q=(h,A,v)=>h.flatMap(N=>A.map(m=>({id:P(),code:I(),product:v.product||null,color:N,size:m,brand:v.brand||null,collar:v.collar||null,elasticity:v.elasticity||null,material:v.material||null,origin:v.origin||null,sleeve:v.sleeve||null,style:v.style||null,texture:v.texture||null,thickness:v.thickness||null,price:v.price||0,quantity:v.quantity||0,mass:v.mass||0,images:[],deleted:!1,createdDate:new Date().toISOString(),modifiedDate:new Date().toISOString()}))),de=O(h=>h.dataDetailedProduct.detailedProduct);return a.jsx(oa,{innerRef:e,initialValues:{...s,code:s.code||"",price:s.price||0,mass:s.mass||0,quantity:s.quantity||0,product:s.product||null,brand:s.brand||null,origin:s.origin||null,style:s.style||null,material:s.material||null,collar:s.collar||null,sleeve:s.sleeve||null,texture:s.texture||null,thickness:s.thickness||null,elasticity:s.elasticity||null,color:s.color||[],size:s.size||[]},validationSchema:xt,onSubmit:(h,{setSubmitting:A})=>{d==null||d(de.data,A),n(je([]))},children:({values:h,touched:A,errors:v,isSubmitting:N,setFieldValue:m})=>{p.useEffect(()=>{if(h.color.length>0&&h.size.length>0&&h.product&&h.brand&&h.origin&&h.style&&h.material&&h.collar&&h.sleeve&&h.texture&&h.thickness&&h.elasticity){const b=q(h.color,h.size,h);n(je(b))}else n(je([]))},[h]);const x=O(b=>b.dataDetailedProduct.detailedProduct.data)||[];return a.jsx(ca,{children:a.jsxs(da,{children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"lg:col-span-1",children:[a.jsx(at,{touched:A,errors:v,values:h,setFieldValue:m,data:C}),a.jsx(rt,{touched:A,errors:v,values:h,setFieldValue:m,data:C})]}),x.length>0?a.jsx("div",{className:"lg:col-span-1",children:a.jsx(ut,{productCombinations:x,errors:v,touched:A})}):a.jsxs("div",{className:"flex flex-col justify-center items-center h-full",children:[a.jsx(Ne,{className:"max-w-[200px]",src:"/img/others/no-mail-selected.png",darkModeSrc:"/img/others/no-mail-selected-dark.png"}),a.jsx("div",{className:"mt-4 text-2xl font-semibold",children:"Chọn các thuộc tính để hiển thị sản phẩm chi tiết."})]})]}),a.jsxs(ha,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[a.jsx("div",{children:" "}),a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(H,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>l==null?void 0:l(),children:"Quay lại"}),a.jsx(H,{size:"sm",className:"ltr:mr-3 rtl:ml-3",loading:N,icon:a.jsx(Fa,{}),type:"submit",variant:"solid",style:{backgroundColor:"rgb(79, 70, 229)"},children:"Lưu"})]})]})]})})}})});_e.displayName="ProductForm";const kt=()=>{const t=ua(),e=async l=>{try{return(await Va(l)).data}catch(n){return console.error("Error adding products:",n),ze.push(a.jsx(Me,{title:"Error",duration:2500,children:"Không thể thêm sản phẩm. Vui lòng thử lại."}),{placement:"top-center"}),!1}},s=async(l,n)=>{n(!0);const u=await e(l);n(!1),u&&(ze.push(a.jsx(Me,{title:"Successfully added",type:"success",duration:2500,children:"Thêm thành công sản phẩm"}),{placement:"top-center"}),t("/admin/manage/product/"))},d=()=>{t("/admin/manage/product/")};return a.jsx(a.Fragment,{children:a.jsx(_e,{onFormSubmit:s,onDiscard:d})})};export{kt as default};
