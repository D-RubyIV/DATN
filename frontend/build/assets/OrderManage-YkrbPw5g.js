import{cP as $,r as s,aH as Q,b1 as Y,bM as y,b2 as l,as as b,j as a,aC as U,b5 as X,ca as J,ci as N,b3 as W,b4 as Z,aQ as ee,b6 as ae,B as f,b7 as te,b8 as se,b9 as ne,ba as le,L as v}from"./index-CmnZOBjS.js";import{T as re,I as oe}from"./ClassicLayout-7NXnncxJ.js";import{f as T}from"./format-CVL-O4zN.js";const ce=()=>{const{addTabByOrderId:j}=$(),[p,E]=s.useState([]),[w,u]=s.useState(!1),[C,D]=s.useState({countAll:0,countPending:0,countToShip:0,countCancelled:0,countDelivered:0,countReturned:0,countToReceive:0}),[r,c]=s.useState({type:"",status:"",createdFrom:"",createdTo:""}),S=Q(),h=e=>{c(t=>({...t,createdFrom:e}))},g=e=>{c(t=>({...t,createdTo:e}))},I=e=>{c(t=>({...t,inStore:e}))},P=e=>{c(t=>({...t,type:e}))},H=e=>{e===l.PENDING?n(t=>({...t,sort:{order:"asc",key:"createdDate"}})):n(t=>({...t,sort:{order:"desc",key:"createdDate"}})),c(t=>({...t,status:e}))},[o,n]=s.useState({total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}}),k=s.useRef(null),L=Y(O,500);function O(e){console.log(e),typeof e=="string"&&(e.length>1||e.length===0)&&n(t=>({...t,query:e,pageIndex:1}))}const R=e=>{L(e.target.value)},m=e=>{console.log("Input formattedDate:",e);const t=se(e,"HH:mm dd-MM-yyyy",new Date);return isNaN(t.getTime())?(console.error("Invalid date format"),"Invalid date"):ne(t,{addSuffix:!0,locale:le})},[d,K]=s.useState([null,null]);s.useEffect(()=>{console.log("dateRange: ",d)},[d]);const x=e=>{if(console.log("Selected range date",e),e[0]){const t=T(e[0],"yyyy-MM-dd'T'HH:mm:ss");console.log(t),h(t)}else h("");if(e[1]){const t=T(e[1],"yyyy-MM-dd'T'HH:mm:ss");console.log(t),g(t)}else g("");K(e)};s.useEffect(()=>{x([y().startOf("day").toDate(),y().endOf("day").toDate()])},[]);const M=[{header:"#",cell:e=>e.row.index+1},{header:"Mã",accessorKey:"code"},{header:"Khách",accessorKey:"customer___name",cell:e=>e.row.original.customerName??"N/a"},{header:"Nhân viên",accessorKey:"staff___name",cell:e=>e.row.original.staffName??"N/a"},{header:"SĐT",accessorKey:"phone",cell:e=>e.row.original.phone||"N/a"},{header:"Tổng giá trị",accessorKey:"subTotal",cell:e=>Math.round(e.row.original.subTotal).toLocaleString("vi")+"đ"},{header:"Tiền giảm",accessorKey:"discount",cell:e=>`(${e.row.original.discountVoucherPercent}%) ~ `+Math.round(e.row.original.discount).toLocaleString("vi")+"đ"},{header:"Phí",accessorKey:"deliveryFee",cell:e=>Math.round(e.row.original.deliveryFee).toLocaleString("vi")+"đ"},{header:"Đã Trả",accessorKey:"totalPaid",cell:e=>Math.round(e.row.original.totalPaid).toLocaleString("vi")+"đ"},{header:"Cần TT",accessorKey:"total",cell:e=>Math.round(e.row.original.total).toLocaleString("vi")+"đ"},{header:"TG tạo",accessorKey:"createdDate",cell:e=>m(e.row.original.createdDate)},{header:"Tg sửa",accessorKey:"updatedDate",cell:e=>m(e.row.original.updatedDate)},{header:"Trạng thái",accessorKey:"status",cell:e=>a.jsx(f,{block:!0,size:"xs",variant:"solid",className:`!bg-none !bg-transparent !bg-opacity-100 ${e.row.original.status==="PENDING"?"!text-yellow-500":e.row.original.status==="TOSHIP"?"!text-blue-500":e.row.original.status==="TORECEIVE"?"!text-green-500":e.row.original.status==="DELIVERED"?"!text-purple-500":e.row.original.status==="CANCELED"?"!text-red-500":"!text-gray-500"}`,children:a.jsxs("span",{className:"flex items-center font-bold",children:[a.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-2 ${e.row.original.status==="PENDING"?"!bg-yellow-500":e.row.original.status==="TOSHIP"?"!bg-blue-500":e.row.original.status==="TORECEIVE"?"!bg-green-500":e.row.original.status==="DELIVERED"?"!bg-purple-500":e.row.original.status==="CANCELED"?"!bg-red-500":"!bg-gray-500"}`}),a.jsx("span",{children:a.jsx("p",{children:e.row.original.status==="PENDING"?"Chờ xác nhân":e.row.original.status==="TOSHIP"?"Chờ vận chuyển":e.row.original.status==="TORECEIVE"?"Đang vận chuyển":e.row.original.status==="DELIVERED"?"Đã hoàn thành":e.row.original.status==="CANCELED"?"Đã hủy đơn":"Không xác định"})})]})})},{header:"PT Nhận Hàng",accessorKey:"type",cell:e=>a.jsx("span",{children:a.jsx(re,{status:e.row.original.type})})},{header:"Loại đơn",accessorKey:"inStore",cell:e=>a.jsx("span",{children:a.jsx(oe,{status:e.row.original.inStore})})},{header:"Hành động",id:"action",cell:e=>a.jsx(f,{size:"xs",className:"w-full flex justify-start items-center",variant:"plain",onClick:()=>F(e.row.original),children:a.jsx(te,{size:20,className:"mr-3 text-2xl",style:{cursor:"pointer"}})})}],F=e=>{e.inStore&&e.status==="PENDING"?(console.log("tai quay"),j(e.id)):(console.log("online"),S(`order-details/${e.id}`))},V=[{label:"TẤT CẢ",value:l.EMPTY,badge:"countAll"},{label:"CHỜ XÁC NHẬN",value:l.PENDING,badge:"countPending"},{label:"CHỜ VẬN CHUYỂN",value:l.TOSHIP,badge:"countToShip"},{label:"ĐANG VẬN CHUYỂN",value:l.TORECEIVE,badge:"countToReceive"},{label:"ĐÃ HOÀN THÀNH",value:l.DELIVERED,badge:"countDelivered"},{label:"ĐÃ HỦY",value:l.CANCELED,badge:"countCancelled"}],A=e=>{n(t=>({...t,pageIndex:e}))},z=e=>{n(t=>({...t,pageSize:e,pageIndex:1}))},G=({order:e,key:t})=>{console.log({order:e,key:t}),n(i=>({...i,sort:{order:e,key:t.replace("___",".")}}))};s.useEffect(()=>{const e=async()=>{u(!0);const t=await b.post("/orders/overview",o,{params:r});console.log(t),t.data&&(E(t.data.content),u(!1),n(i=>({...i,total:t.data.totalElements})))};B(),e()},[o.pageIndex,o.sort,o.pageSize,o.query,r]);const _=[{label:"Tất cả",value:""},{label:"Tại quầy",value:"INSTORE"},{label:"Giao hàng",value:"ONLINE"}],q=[{label:"Tất cả",value:null},{label:"Tại quầy",value:!0},{label:"Trực tuyến",value:!1}],B=async()=>{const e={type:r.type,createdFrom:r.createdFrom,createdTo:r.createdTo};b.get("orders/count-any-status",{params:e}).then(function(t){t.data&&D(t.data)})};return a.jsxs(a.Fragment,{children:[a.jsx("div",{children:a.jsx("h1",{className:"font-semibold text-xl text-black mb-4 text-transform: uppercase",children:"Quản lý hóa đơn"})}),a.jsxs("div",{className:"grid grid-cols-4 gap-2 py-2",children:[a.jsx("div",{children:a.jsxs("div",{className:"relative mr-4",children:[a.jsx("p",{className:"font-black",children:"Tìm kiếm"}),a.jsx(U,{size:"sm",ref:k,placeholder:"Tìm kiếm theo mã, tên nhân viên, tên khách hàng ...",className:"lg:w-full",prefix:a.jsx(X,{className:"text-lg"}),onChange:R})]})}),a.jsxs("div",{className:"relative mr-4",children:[a.jsx("p",{className:"font-black",children:"Lọc khoảng ngày"}),a.jsx(J.DatePickerRange,{size:"sm",placeholder:"Chọn khoảng ngày",value:d,dateViewCount:2,onChange:x})]}),a.jsxs("div",{className:"relative mr-4",children:[a.jsx("p",{className:"font-black",children:"Hình thức nhận hàng"}),a.jsx(N,{size:"sm",placeholder:"Loại hóa đơn",options:_,onChange:e=>{P(e.value)}})]}),a.jsxs("div",{className:"relative mr-4",children:[a.jsx("p",{className:"font-black",children:"Hình thức tạo đơn"}),a.jsx(N,{size:"sm",placeholder:"Hình thức tạo đơn",options:q,onChange:e=>{I(e.value)}})]})]}),a.jsx("div",{className:"py-2",children:a.jsx(W,{className:"flex justify-evenly gap-4 w-full bg-white pt-3 pb-1",children:V.map((e,t)=>a.jsx(Z,{className:`w-full rounded ${r.status===e.value?"bg-opacity-80 bg-blue-100 text-indigo-600":""}`,value:e.value,children:a.jsx(ee,{className:"mr-5",content:C[e.badge]||0,maxCount:99,innerClass:"bg-red-50 text-red-500",children:a.jsx("button",{className:"p-2 w-auto",onClick:()=>H(e.value),children:e.label})})},t))})}),a.jsx("div",{className:"py-4 px-2",children:a.jsx(ae,{columns:M,data:p,loading:w,pagingData:o,onPaginationChange:A,onSelectChange:z,onSort:G})})]})},he=()=>a.jsx("div",{className:"bg-white h-full",children:a.jsxs("div",{className:"p-5 rounded-md card h-full card-border",children:[a.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:a.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:a.jsxs("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:[a.jsx("li",{children:a.jsx("div",{className:"flex items-center",children:a.jsx(v,{to:"/",className:"text-gray-700 hover:text-blue-600",children:"Trang Chủ"})})}),a.jsx("li",{children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"mx-2",children:"/"}),a.jsx(v,{to:"/manage",className:"text-gray-700 hover:text-blue-600",children:"Quản Lý"})]})}),a.jsx("li",{"aria-current":"page",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"mx-2",children:"/"}),a.jsx("span",{className:"text-gray-500",children:"Hóa đơn"})]})})]})})}),a.jsx("div",{children:a.jsx(ce,{})})]})});export{he as default};
