import{cS as U,cT as _,bW as ae,bY as se,n as w,j as t,bt as ne,aE as S,cd as B,at as re,au as oe,aO as X,ap as ie,i as le,ax as ce,ay as de,az as ue,aA as Q,aB as me,aC as H,B as T,r as y,aQ as ge,b6 as he,C as be,dK as pe,cf as xe,cm as k,b1 as fe,b5 as Ae,ce as Ce,aM as je}from"./index-D8wAv7Ri.js";import{u as O,b as De,R as ye,a as we}from"./xlsx-B45T4I3p.js";import{D as Se}from"./DoubleSidedImage-yCgr4CK9.js";import{A as Ne}from"./index.esm-Dz4CnRAP.js";const W="salesAttributeList",N=U(`${W}/getAttributes`,async({apiFunc:a,requestData:e})=>{const s=await a(e);if(!s||!s.data)throw new Error("Invalid response from API");return s.data}),Te=(a,e)=>{const s=a.map((d,r)=>({STT:r+1,Mẫ:d.code,Tên:d.name,"Ngày Tạo":d.createdDate,"Trạng thái":ve(d.deleted)})),i=O.json_to_sheet(s),m=O.book_new();O.book_append_sheet(m,i,"Product Details"),De(m,`DANH_SACH_${e}.xlsx`)},ve=a=>a===void 0||a===!0?"Dừng hoạt động":"Đang hoạt động",Ie=async(a,e)=>await a(e),ke=async(a,e,s)=>await a(e,s),Le={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Ee={loading:!1,deleteConfirmation:!1,selectedAttribute:"",AttributeList:[],tableData:Le},Y=_({name:`${W}/state`,initialState:Ee,reducers:{updateAttributeList:(a,e)=>{a.AttributeList=e.payload},setTableData:(a,e)=>{a.tableData=e.payload},toggleDeleteConfirmation:(a,e)=>{a.deleteConfirmation=e.payload},setSelectedAttribute:(a,e)=>{a.selectedAttribute=e.payload}},extraReducers:a=>{a.addCase(N.fulfilled,(e,s)=>{e.AttributeList=s.payload.content,e.tableData.total=s.payload.totalElements,e.loading=!1}).addCase(N.pending,e=>{e.loading=!0})}}),{updateAttributeList:Je,setTableData:L,toggleDeleteConfirmation:$,setSelectedAttribute:qe}=Y.actions,ze=Y.reducer,G="attributeNew",E=U(`${G}/addAttribute`,async({AttributeData:a,apiAdd:e})=>{const s=await e(a);if(!s||!s.data)throw new Error("Invalid response from API");return s.data}),Re={loading:!1,addAttribute:!1,dataAttribute:null},J=_({name:G,initialState:Re,reducers:{setAttributeData:(a,e)=>{a.dataAttribute=e.payload},toggleAddAttributeConfirmation:(a,e)=>{a.addAttribute=e.payload}},extraReducers:a=>{a.addCase(E.fulfilled,(e,s)=>{e.loading=!1,e.dataAttribute=s.payload,e.addAttribute=!1}).addCase(E.pending,e=>{e.loading=!0}).addCase(E.rejected,e=>{e.loading=!1})}}),{setAttributeData:Ze,toggleAddAttributeConfirmation:P}=J.actions,Me=J.reducer,Oe="updateAttribute",q=U(`${Oe}/getAttributes`,async({apiFunc:a,params:e})=>{const s=await a(e);if(!s||!s.data)throw new Error("Invalid response from API");return s.data}),$e={loading:!1,updateConfirmation:!1,attributeData:null},Z=_({name:"updateAttribute",initialState:$e,reducers:{resetState:a=>{a.loading=!1,a.updateConfirmation=!1,a.attributeData=null},toggleUpdateConfirmation:(a,e)=>{a.updateConfirmation=e.payload}},extraReducers:a=>{a.addCase(q.pending,e=>{e.loading=!0}).addCase(q.fulfilled,(e,s)=>{e.loading=!1,e.attributeData=s.payload}).addCase(q.rejected,e=>{e.loading=!1})}}),{resetState:et,toggleUpdateConfirmation:ee}=Z.actions,Pe=Z.reducer,F=ae({attributeAdd:Me,data:ze,attibuteUpdate:Pe}),g=se,Ue=({apiFunc:a,apiDelete:e,lablel:s})=>{const i=w(),m=g(b=>b.salesAttributeList.data.deleteConfirmation),d=g(b=>b.salesAttributeList.data.selectedAttribute);g(b=>b.salesAttributeList.data.tableData);const r=()=>{i($(!1))},{pageIndex:h,pageSize:o,sort:u,query:f,total:C}=g(b=>b.salesAttributeList.data.tableData),j=async()=>{i($(!1)),await Ie(e,{id:d})?(i(N({apiFunc:a,requestData:{pageIndex:h,pageSize:o,sort:u,query:f}})),S.success("Cập nhật trạng thái thành công")):S.error("Lỗi cập nhật trạng thái. Vui lòng thử lại.")};return t.jsx(ne,{isOpen:m,type:"danger",title:`Xóa ${s}`,confirmButtonColor:"red-600",cancelText:"Hủy",confirmText:"Xác nhận",onClose:r,onRequestClose:r,onCancel:r,onConfirm:j,children:t.jsxs("p",{children:["Bạn có chắc chắn muốn ngừng sử dụng ",s," này không? Tất cả sản phẩm chi tiết liên quan đến ",s," này cũng sẽ bị xóa."]})})};B("updateAttribute",F);const _e=({apiFunc:a,label:e,apiUpdate:s})=>{const i=w(),m=g(c=>c.updateAttribute.attibuteUpdate.updateConfirmation),d=g(c=>c.updateAttribute.attibuteUpdate.loading),r=()=>{i(ee(!1))},h=g(c=>c.updateAttribute.attibuteUpdate.attributeData),o=re().shape({name:oe().required("Tên không được bỏ trống!")}),{pageIndex:u,pageSize:f,sort:C,query:j,total:b}=g(c=>c.salesAttributeList.data.tableData);return t.jsxs(X,{isOpen:m,onClose:r,onRequestClose:r,shouldCloseOnEsc:!1,shouldCloseOnOverlayClick:!1,children:[t.jsxs("h5",{className:"mb-4",children:["Sửa ",e]}),t.jsx(ie,{loading:d,children:!le(h)&&t.jsx(ce,{initialValues:{...h},validationSchema:o,onSubmit:async(c,{setSubmitting:A})=>{A(!0);try{const x=await ke(s,{name:c.name},c.id);A(!1),x?(i(N({apiFunc:a,requestData:{pageIndex:u,pageSize:f,sort:C,query:j}})),r(),S.success(`Cập nhật ${e} thành công`)):(r(),S.error(`Lỗi cập nhật  ${e}. Vui lòng thử lại.`))}catch(x){A(!1),console.error("Update failed:",x)}},children:({values:c,touched:A,errors:x,isSubmitting:v})=>t.jsx(de,{children:t.jsxs(ue,{children:[t.jsx(Q,{label:`Tên ${e}`,invalid:!!(x.name&&A.name),errorMessage:x.name,children:t.jsx(me,{type:"text",autoComplete:"off",name:"name",placeholder:"Tên",component:H})}),t.jsxs("div",{className:"-mx-8 px-8 flex items-center justify-between py-4",children:[t.jsx("div",{children:" "}),t.jsxs("div",{className:"md:flex items-center mt-4",children:[t.jsx(T,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:r,children:"Hủy"}),t.jsx(T,{size:"sm",variant:"solid",loading:v,icon:t.jsx(Ne,{}),type:"submit",children:"Lưu"})]})]})]})})})})]})},V=a=>t.jsx("div",{className:"text-lg",children:a}),Be=({row:a})=>t.jsx("div",{className:"flex items-center",children:t.jsx("span",{className:"ml-2 rtl:mr-2 font-semibold",children:a.name})}),He=a=>a?{label:"Dừng hoạt động",dotClass:"bg-red-500",textClass:"text-red-500"}:{label:"Đang hoạt động",dotClass:"bg-emerald-500",textClass:"text-emerald-500"},Fe=({apiFunc:a,apiDelete:e,lablel:s,apiGetByID:i,apiUpdate:m})=>{const d=y.useRef(null),r=w(),{pageIndex:h,pageSize:o,sort:u,query:f,total:C}=g(n=>n.salesAttributeList.data.tableData),j=g(n=>n.salesAttributeList.data.loading),b=g(n=>n.salesAttributeList.data.AttributeList);y.useEffect(()=>{A()},[h,o,u]);const c=y.useMemo(()=>({pageIndex:h,pageSize:o,sort:u,query:f,total:C}),[h,o,u,f,C]),A=()=>{r(N({apiFunc:a,requestData:{pageIndex:h,pageSize:o,sort:u,query:f}}))},x=({row:n})=>{const l=w();be();const D=()=>{l($(!0)),l(qe(n.id))},R=()=>{l(ee(!0)),l(q({apiFunc:i,params:{id:n.id}})).unwrap()},M=(te,K)=>{D()};return t.jsxs("div",{className:"flex w-full justify-start gap-2 items-center",children:[t.jsx(pe,{onClick:R,size:20,className:"mr-3 text-2xl",style:{cursor:"pointer"}}),t.jsx(xe,{className:"text-sm",unCheckedContent:V(t.jsx(ye,{})),checkedContent:V(t.jsx(we,{})),color:"green-500",checked:!n.deleted,onChange:M})]})},v=y.useMemo(()=>[{header:"#",id:"index",cell:n=>{const{pageIndex:l,pageSize:D}=g(K=>K.salesAttributeList.data.tableData),R=l??0,M=D??10;return(R-1)*M+(n.row.index+1)}},{header:"Mã",accessorKey:"code",cell:n=>{const l=n.row.original;return t.jsx("span",{className:"capitalize",children:l.code})}},{header:"Tên",accessorKey:"name",cell:n=>{const l=n.row.original;return t.jsx(Be,{row:l})}},{header:"Ngày tạo",accessorKey:"createdDate"},{header:"Trạng thái",accessorKey:"deleted",cell:n=>{const{deleted:l}=n.row.original,D=He(l);return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ge,{className:D.dotClass}),t.jsx("span",{className:`capitalize font-semibold ${D.textClass}`,children:D.label})]})}},{header:"Hành động",id:"action",cell:n=>t.jsx(x,{row:n.row.original})}],[]),z=n=>{const l=k(c);l.pageIndex=n,r(L(l))},p=n=>{const l=k(c);l.pageSize=Number(n),l.pageIndex=1,r(L(l))},I=n=>{const l=k(c);l.sort=n,r(L(l))};return t.jsxs(t.Fragment,{children:[b.length>0?t.jsx(he,{ref:d,columns:v,data:b,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:j,pagingData:{total:c.total,pageIndex:c.pageIndex,pageSize:c.pageSize},onPaginationChange:z,onSelectChange:p,onSort:I}):t.jsxs("div",{className:"flex flex-col justify-center items-center h-full",children:[t.jsx(Se,{className:"max-w-[200px]",src:"/img/others/image-removebg-preview-order-empty.png",darkModeSrc:"/img/others/image-removebg-preview-order-empty.png"}),t.jsxs("div",{className:"mt-4 text-2xl font-semibold",children:["Không có ",s," nào!!!"]})]}),t.jsx(Ue,{apiDelete:e,apiFunc:a,lablel:s}),t.jsx(_e,{apiFunc:a,label:s,apiUpdate:m})]})},Ke=({apiFunc:a})=>{const e=w(),s=y.useRef(null),i=g(o=>o.salesAttributeList.data.tableData),m=fe(d,500);function d(o){const u=k(i);u.query=o,u.pageIndex=1,typeof o=="string"&&o.length>1&&r(u),typeof o=="string"&&o.length===0&&r(u)}const r=o=>{e(L(o)),e(N({apiFunc:a,requestData:o}))},h=o=>{m(o.target.value)};return t.jsx(H,{ref:s,className:"max-w-md md:w-65 md:mb-0 mb-4 ",size:"sm",placeholder:"TÌM KIẾM THEO MÃ, TÊN ...",prefix:t.jsx(Ae,{className:"text-lg"}),onChange:h})};B("attributeNew",F);const Ve=({apiFunc:a,apiAdd:e,label:s})=>{const i=w(),m=g(p=>p.attributeNew.attributeAdd.addAttribute),[d,r]=y.useState(""),[h,o]=y.useState(null),u=()=>{i(P(!1))},f=()=>{const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:5},()=>p.charAt(Math.floor(Math.random()*p.length))).join("")},C=p=>({id:Math.floor(Math.random()*1e3),code:f(),name:p,deleted:!1,createdDate:new Date().toISOString(),modifiedDate:new Date().toISOString()}),j=p=>{const I=p.target.value;r(I);const n=C(I);o(n)},{pageIndex:b,pageSize:c,sort:A,query:x,total:v}=g(p=>p.salesAttributeList.data.tableData),z=async()=>{if(!h)return;i(P(!1)),await i(E({AttributeData:h,apiAdd:e}))?(i(N({apiFunc:a,requestData:{pageIndex:b,pageSize:c,sort:A,query:x}})),S.success(`${s} thành công`)):S.error(`Lỗi khi thêm ${s}. Vui lòng thử lại.`)};return t.jsxs(X,{isOpen:m,onClose:u,onRequestClose:u,shouldCloseOnEsc:!1,shouldCloseOnOverlayClick:!1,children:[t.jsxs("h5",{className:"mb-4",children:["Thêm ",s]}),t.jsx(Q,{label:`Tên ${s}`,children:t.jsx(H,{value:d,onChange:j})}),t.jsxs("div",{className:"text-right mt-6",children:[t.jsx(T,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:u,children:"Hủy bỏ"}),t.jsx(T,{style:{backgroundColor:"rgb(79, 70, 229)",height:"40px"},variant:"solid",onClick:z,children:"Xác nhận"})]})]})},Xe=({apiFunc:a,lablel:e,apiAdd:s})=>{const i=w(),m=g(r=>r.salesAttributeList.data.AttributeList),d=()=>{Te(m,e),S.success("Xuất thành công file sản phẩm.")};return t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[t.jsx("div",{className:"flex-grow mb-4 lg:mb-0",children:t.jsx(Ke,{apiFunc:a})}),t.jsxs("div",{className:"flex-shrink-0",children:[t.jsx("div",{className:"block lg:inline-block md:mx-2 md:mb-0 mb-4",children:t.jsx(T,{block:!0,size:"sm",onClick:d,icon:t.jsx(Ce,{}),children:"Xuất Excel"})}),t.jsx("div",{className:"block lg:inline-block  md:mb-0 mb-4",children:t.jsxs(T,{size:"sm",variant:"solid",style:{backgroundColor:"rgb(79, 70, 229)",height:"40px"},className:"flex items-center justify-center gap-2 button-bg-important",icon:t.jsx(je,{}),onClick:r=>i(P(!0)),children:["Thêm ",e]})})]}),t.jsx(Ve,{apiAdd:s,apiFunc:a,label:e})]})};B("salesAttributeList",F);const tt=({apiFunc:a,lablel:e,apiDelete:s,apiAdd:i,apiGetByID:m,apiUpdate:d})=>t.jsx("div",{className:"bg-white h-full",children:t.jsxs("div",{className:"p-8 shadow-md rounded-md card h-full card-border",children:[t.jsxs("h1",{className:"font-semibold text-xl mb-4 text-transform: uppercase",children:["Quản lý ",e]}),t.jsx("div",{className:"mb-5 mt-6",children:t.jsx(Xe,{apiFunc:a,lablel:e,apiAdd:i})}),t.jsx(Fe,{apiFunc:a,apiDelete:s,lablel:e,apiGetByID:m,apiUpdate:d})]})});export{tt as A};
