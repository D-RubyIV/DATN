import{bG as J,aH as K,r as i,aI as W,at as X,au as y,aD as x,ak as g,bF as Z,j as e,ax as _,ay as E,L as C,az as ee,aA as h,aB as D,aC as k,dc as H,bM as l,B as Y}from"./index-BTLFdfuL.js";const se=()=>{const{id:u}=J(),w=K(),[t,I]=i.useState(null),[$,q]=i.useState([]),[p,F]=i.useState(0),[o,N]=i.useState(1),[m,te]=i.useState(5),[M,P]=i.useState([]);i.useState(),i.useState();const[A,B]=i.useState({currentName:""}),{openNotification:b}=W(),G=X().shape({name:y().required("Tên đợt giảm giá là bắt buộc").min(3,"Tên phải có ít nhất 3 ký tự").test("name-unique","Tên sự kiện đã tồn tại",async a=>a===A.currentName?!0:!(await x.get(`${g.apiPrefix}/event/check-name`,{params:{name:a}})).data.exists),discountPercent:Z().required("Giá trị giảm là bắt buộc").min(0,"Giá trị giảm phải lớn hơn hoặc bằng 0").max(100,"Giá trị giảm không được vượt quá 100"),startDate:y().required("Ngày bắt đầu là bắt buộc"),endDate:y().required("Ngày kết thúc là bắt buộc")});i.useEffect(()=>{(async()=>{try{const n=await x.get(`${g.apiPrefix}/event/detail/${u}`);B({currentName:n.data.name}),I(n.data),console.log("Dữ liệu tải lên: ",n.data)}catch(n){console.error("Error fetching event details:",n)}})(),z(o,m)},[u,o,m]),i.useEffect(()=>{t&&P(t.productDTOS.map(a=>a.id))},[t]);const z=async(a,n)=>{try{const s=await x.get(`${g.apiPrefix}/event/product-list`,{params:{page:a,size:n}});q(s.data.content||[]),F(s.data.totalElements)}catch(s){console.error("Error fetching products:",s)}},U=async(a,{resetForm:n,setSubmitting:s})=>{try{if(console.log("Received form values:",a),console.log("SUBMIT DATE START: ",a.startDate),console.log("SUBMIT DATE END: ",a.endDate),a.startDate&&a.endDate&&l(a.startDate,"HH:mm DD-MM-YYYY").toDate()>l(a.endDate,"HH:mm DD-MM-YYYY").toDate()){b("Ngày bắt đầu phải trước ngày kết thúc","Thông báo","warning",5e3);return}const c=(t==null?void 0:t.startDate)||"",d=(t==null?void 0:t.endDate)||"";console.log("startDate ban đầu từ API:",c),console.log("endDate ban đầu từ API:",d);const j=a.startDate!==c,r=a.endDate!==d;console.log("Is startDate changed:",j),console.log("Is endDate changed:",r);const f=j?l(a.startDate,"DD-MM-YYYYTHH:mm",!0):l(c,"DD-MM-YYYYTHH:mm",!0),Q=r?l(a.endDate,"DD-MM-YYYYTHH:mm",!0):l(d,"DD-MM-YYYYTHH:mm",!0);console.log("Parsed startDate:",f.toString()),console.log("Parsed endDate:",Q.toString());const T={...a,discountPercent:a.discountPercent,startDate:a.startDate,endDate:a.endDate,productDTOS:M.map(V=>({id:V}))};console.log("Formatted payload:",T);const S=await x.put(`${g.apiPrefix}/event/update/${u}`,T);S.status===200&&(console.log("Update response:",S),b("Cập nhật thành công"),n(),w("/admin/manage/event"))}catch(c){console.error("Error while updating the event:",c),b("Cập nhật sự kiện thất bại","Thông báo","warning",5e3)}finally{s(!1)}},O=(a,n)=>{P(s=>n?[...s,a.id]:s.filter(c=>c!==a.id))},R=a=>M.includes(a),L=()=>{o>1&&N(a=>a-1)},v=()=>{o<Math.ceil(p/m)&&N(a=>a+1)};return e.jsx("div",{className:"h-full",children:e.jsx(_,{initialValues:{id:t==null?void 0:t.id,discountCode:t==null?void 0:t.discountCode,name:t==null?void 0:t.name,discountPercent:t==null?void 0:t.discountPercent,startDate:t==null?void 0:t.startDate,endDate:t==null?void 0:t.endDate,quantityDiscount:t==null?void 0:t.quantityDiscount,status:t==null?void 0:t.status,productDTOS:[]},validationSchema:G,enableReinitialize:!0,onSubmit:U,children:({initialValues:a,touched:n,errors:s,isSubmitting:c,setFieldValue:d,values:j})=>e.jsxs(E,{className:"h-full",children:[e.jsx("h1",{className:"font-semibold text-xl mb-4 uppercase",children:"Cập nhật đợt giảm giá"}),e.jsxs("div",{className:"w-full bg-white p-6 shadow-md rounded-lg h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:[e.jsx("li",{children:e.jsx("div",{className:"flex items-center",children:e.jsx(C,{to:"/",className:"text-gray-700 hover:text-blue-600",children:"Trang Chủ"})})}),e.jsx("li",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx(C,{to:"/manage",className:"text-gray-700 hover:text-blue-600",children:"Quản Lý"})]})}),e.jsx("li",{"aria-current":"page",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("span",{className:"text-gray-500",children:"Cập nhật đợt giảm giá"})]})})]})})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"w-full lg:w-1/3 bg-white rounded-lg",children:e.jsxs(ee,{children:[e.jsx(h,{asterisk:!0,label:"Tên đợt giảm giá",invalid:!!s.name&&n.name,errorMessage:s.name,children:e.jsx(D,{type:"text",name:"name",placeholder:"Tên đợt giảm giá...",component:k})}),e.jsx(h,{asterisk:!0,label:"Giá trị giảm(%)",invalid:!!s.discountPercent&&n.discountPercent,errorMessage:s.discountPercent,children:e.jsx(D,{type:"number",name:"discountPercent",placeholder:"Giá trị giảm(%)...",component:k})}),e.jsx(h,{asterisk:!0,label:"Ngày bắt đầu",invalid:!!s.startDate&&n.startDate,errorMessage:s.startDate,children:e.jsx(D,{name:"startDate",children:()=>e.jsx("div",{children:e.jsx(H,{inputFormat:"DD/MM/YYYY HH:mm",placeholder:t==null?void 0:t.startDate,onChange:r=>{d("startDate",l(r).format("HH:mm DD-MM-YYYY"))}})})})}),e.jsx(h,{asterisk:!0,label:"Ngày kết thúc",invalid:!!s.endDate&&n.endDate,errorMessage:s.endDate,children:e.jsx(D,{name:"endDate",children:()=>e.jsx("div",{children:e.jsx(H,{inputFormat:"DD/MM/YYYY HH:mm",placeholder:t==null?void 0:t.endDate,onChange:r=>{d("endDate",l(r).format("HH:mm DD-MM-YYYY"))}})})})}),e.jsx(h,{children:e.jsx(Y,{variant:"solid",type:"submit",style:{backgroundColor:"rgb(79, 70, 229)",height:"40px"},disabled:c,children:"Cập nhật"})})]})}),e.jsxs("div",{className:"w-full lg:w-2/3 bg-white p-6 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-xl mb-4",children:"Danh sách sản phẩm"}),e.jsxs("table",{className:"table-auto w-full border border-collapse border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Chọn"}),e.jsx("th",{className:"border px-4 py-2",children:"Mã sản phẩm"}),e.jsx("th",{className:"border px-4 py-2",children:"Tên sản phẩm"})]})}),e.jsx("tbody",{children:$.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:R(r.id),onChange:f=>O(r,f.target.checked)})}),e.jsx("td",{className:"border px-4 py-2",children:r.code}),e.jsx("td",{className:"border px-4 py-2",children:r.name})]},r.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(Y,{type:"button",disabled:o===1,onClick:L,children:"Trang trước"}),e.jsxs("span",{children:["Trang ",o," / ",Math.ceil(p/m)]}),e.jsx(Y,{type:"button",disabled:o>=Math.ceil(p/m),onClick:v,children:"Trang sau"})]})]})]})]})]})})})};export{se as default};
