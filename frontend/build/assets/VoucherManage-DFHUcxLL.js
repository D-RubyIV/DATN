import{j as e,B as y,ce as B,L as f,aM as M,r as l,aH as $,aI as q,cf as A,ck as R,as as N,aD as H,aC as X,b6 as Q,aE as O}from"./index-BcxyKQIP.js";import{l as U}from"./lodash-CWYnXvfC.js";import{I as W}from"./index.esm-JltcYuxb.js";import{R as Y,a as J,u as m,w as Z}from"./xlsx-CEEYYDki.js";import{F as ee}from"./FileSaver.min-BM_yJjpl.js";import{T as k}from"./index-PK1Yk7v0.js";import{h as te}from"./ClassicLayout-fQzh7gUg.js";import"./index-B6dRM5RU.js";import"./context-DszELtFQ.js";import"./useMergedState-BsmbDnph.js";import"./ContextIsolator-COlvdSdv.js";const se=({exportToExcel:h})=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center",children:[e.jsx(y,{className:"mr-2",block:!0,onClick:h,size:"sm",icon:e.jsx(B,{}),children:"Xuất Excel"}),e.jsx(f,{className:"block lg:inline-block md:mb-0 mb-4",to:"/admin/manage/voucher/voucher-new",children:e.jsx(y,{block:!0,variant:"solid",size:"sm",color:"blue",icon:e.jsx(M,{}),children:"Thêm Mới"})})]}),ae=()=>{const[h,b]=l.useState([]),[j,v]=l.useState(!1),[T,ne]=l.useState(""),[u,w]=l.useState(""),C=$(),{openNotification:d}=q(),[i,c]=l.useState({pageIndex:1,pageSize:10,sort:{order:"",key:""},query:"",total:0,statusFilter:"",typeTicketFilter:""}),[S,re]=l.useState({totalPages:0,currentPage:0,totalItems:0,pageSize:10});l.useEffect(()=>{g()},[S.currentPage,u]);const I=()=>{if(h.length===0){O.info("Không có dữ liệu để xuất.");return}const t=h.map((n,x)=>({Stt:x+1,Tên:n.name,"Loại Phiếu":n.typeTicket==="Individual"?"Cá nhân":"Mọi người","Số Lượng":n.quantity,"Phần Trăm Tối Đa":`${n.maxPercent}%`,"Giá Tối Thiểu":`${n.minAmount.toLocaleString("vi-VN")} ₫`,"Ngày Bắt Đầu":n.startDate,"Ngày Kết Thúc":n.endDate,"Trạng Thái":n.status==="In progress"?"Đang diễn ra":n.status==="Not started yet"?"Chưa bắt đầu":n.status==="Expired"?"Đã kết thúc":"Không xác định"})),s=m.json_to_sheet(t),a=m.book_new();m.book_append_sheet(a,s,"Danh sách Phiếu Giảm Giá");const r=Z(a,{bookType:"xlsx",type:"array"}),o=new Blob([r],{type:"application/octet-stream"});ee.saveAs(o,"Danh_sach_Phieu_Giam_Gia.xlsx")};U.debounce(t=>{c(s=>({...s,query:t,pageIndex:1}))},500);const F=t=>{c(s=>({...s,pageIndex:t}))},E=t=>{c(s=>({...s,pageSize:t,pageIndex:1}))},K=({order:t,key:s})=>{c(a=>{const r=a.sort.key===s&&a.sort.order==="asc"?"desc":"asc";return{...a,sort:{order:r,key:s},pageIndex:1}})},P=t=>{c(s=>({...s,statusFilter:t.target.value,typeTicketFilter:t.target.value,pageIndex:1}))},L=t=>{c(s=>({...s,typeTicketFilter:t.target.value,pageIndex:1}))},D=l.useMemo(()=>[{header:"Mã",accessorKey:"code"},{header:"Tên ",accessorKey:"name"},{header:"Loại Phiếu",accessorKey:"typeTicket",cell:({row:t})=>{const s=t.original.typeTicket;return e.jsx("span",{children:s==="Individual"?"Cá nhân":"Mọi người"})}},{header:"Số Lượng",accessorKey:"quantity"},{header:"Phần Trăm Tối Đa",accessorKey:"maxPercent",cell:({getValue:t})=>`${t()}%`},{header:"Giá Tối Thiểu",accessorKey:"minAmount",cell:({getValue:t})=>t().toLocaleString("vi-VN",{style:"currency",currency:"VND"})},{header:"Ngày Bắt Đầu",accessorKey:"startDate"},{header:"Ngày Kết Thúc",accessorKey:"endDate"},{header:"Trạng Thái",accessorKey:"status",cell:({row:t})=>{const s=t.original.status;let a,r,o;return s==="In progress"?(a="bg-green-600",r="text-green-600",o="Đang diễn ra"):s==="Not started yet"?(a="bg-red-600",r="text-red-600",o="Chưa bắt đầu"):s==="Expired"?(a="bg-yellow-600",r="text-yellow-600",o="Đã kết thúc"):(a="bg-gray-500",r="text-gray-500",o="Không xác định"),e.jsxs("span",{className:`flex items-center font-bold ${r}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-2 ${a}`}),o]})},size:100},{header:"Hành động",id:"action",cell:({row:t})=>{const{id:s,deleted:a}=t.original;return e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(k,{title:a?"Kích hoạt lại":"Xoá Phiếu Giảm Giá",children:e.jsx(A,{color:"green-500",checked:!a,unCheckedContent:e.jsx(Y,{}),checkedContent:e.jsx(J,{}),className:"text-sm",onChange:()=>z(s,!a)})}),e.jsx(k,{title:"Cập nhật",children:e.jsx(y,{size:"xs",onClick:()=>G(s),children:e.jsx(R,{})})})]})},size:100}],[]),z=async(t,s)=>{try{(await N.put(`/voucher/delete/${t}`,{softDelete:s})).status===200?(d(s?"Xoá phiếu giảm giá thành công":"Kích hoạt lại phiếu giảm giá thành công"),g()):d("Có lỗi xảy ra. Vui lòng thử lại.","Thông báo","warning",5e3)}catch(a){H.isAxiosError(a)&&a.response?d(`Có lỗi xảy ra: ${a.response.data.message||"Vui lòng thử lại."}`,"Thông báo","warning",5e3):d("Có lỗi xảy ra. Vui lòng thử lại.","Thông báo","warning",5e3),console.error("Error deleting voucher:",a)}};l.useEffect(()=>{c(t=>({...t,query:T,pageIndex:1}))},[T]);const g=async()=>{v(!0);try{const{pageIndex:t,pageSize:s,query:a,sort:r,statusFilter:o,typeTicketFilter:n}=i,x={page:t-1,size:s,search:a,sort:r.key,order:r.order,keyword:u||""};o?x.status=o:n&&(x.typeTicket=n),console.log("Fetching data with params:",x);const p=await N.get("/voucher/page",{params:x});p.data?(b(p.data.content),c(_=>({..._,total:p.data.totalElements}))):b([])}catch(t){d("Có lỗi xảy ra. Vui lòng thử lại.","Thông báo","warning",5e3),console.error("Error fetching data:",t)}finally{v(!1)}},G=t=>{C(`/admin/manage/voucher/update/${t}`)},V=t=>{w(t.target.value)};return l.useEffect(()=>{g()},[i.pageIndex,i.sort,i.pageSize,i.query,i.statusFilter,i.typeTicketFilter]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white mb-6 w-full",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xl font-bold mx-auto mb-5 text-black uppercase",children:"Quản Lý Phiếu Giảm Giá"}),e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-center mb-4",style:{marginBottom:"20px",overflow:"hidden",maxWidth:"100%"},children:e.jsxs("div",{className:"flex items-center w-full justify-between flex-wrap",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{style:{position:"relative",width:"500px"},children:[e.jsx(W,{style:{position:"absolute",left:"5px",top:"50%",transform:"translateY(-50%)",fontSize:"20px",pointerEvents:"none"}}),e.jsx(X,{placeholder:"Tìm kiếm theo tên, mã",style:{width:"100%",height:"37px",paddingLeft:"30px",boxSizing:"border-box"},value:u,onChange:V})]}),e.jsxs("select",{className:"border border-gray-300 rounded focus:outline-none",value:i.statusFilter||"",onChange:P,style:{height:"37px",marginLeft:"8px",padding:"0 12px",boxSizing:"border-box"},children:[e.jsx("option",{value:"",children:"Tất cả trạng thái"}),e.jsx("option",{value:"In progress",children:"Đang diễn ra"}),e.jsx("option",{value:"Expired",children:"Đã kết thúc"}),e.jsx("option",{value:"Not started yet",children:"Chưa bắt đầu"})]}),e.jsxs("select",{className:"border border-gray-300 rounded focus:outline-none",value:i.typeTicketFilter||"",onChange:L,style:{height:"37px",marginLeft:"8px",padding:"0 12px",boxSizing:"border-box"},children:[e.jsx("option",{value:"",children:"Tất cả trạng thái"}),e.jsx("option",{value:"Individual",children:"Cá Nhân"}),e.jsx("option",{value:"Everybody",children:"Mọi Người"})]})]}),e.jsx("div",{className:"flex items-center space-x-2 justify-end",children:e.jsx(se,{exportToExcel:I})})]})}),e.jsx("div",{className:"overflow-x-auto",children:j?e.jsx("p",{children:"Đang tải..."}):h.length===0?e.jsx("p",{children:"Không tìm thấy phiếu giảm giá phù hợp"}):e.jsx(Q,{columns:D,data:h,loading:j,pagingData:i,onPaginationChange:F,onSelectChange:E,onSort:K})})]})})})},ye=()=>e.jsxs(te,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:[e.jsx("li",{children:e.jsx("div",{className:"flex items-center",children:e.jsx(f,{to:"/",className:"text-gray-700 hover:text-blue-600",children:"Trang Chủ"})})}),e.jsx("li",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx(f,{to:"/manage",className:"text-gray-700 hover:text-blue-600",children:"Quản Lý"})]})}),e.jsx("li",{"aria-current":"page",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("span",{className:"text-gray-500",children:"Phiếu Giảm Giá"})]})})]})})}),e.jsx(ae,{})]});export{ye as default};
