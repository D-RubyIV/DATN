import{at as F,au as o,r as m,j as e,av as b,aw as M,ax as S,ay as k,az as N,aA as h,aB as p,aC as x,B as E,aD as f,ak as j,aE as c}from"./index-CHgCMjEm.js";import{r as q}from"./ClassicLayout-C2xdmnwD.js";const B=F().shape({email:o().required("Please enter your email").email("Invalid email address"),verificationCode:o().when("emailSent",{is:!0,then:o().required("Please enter the verification code")}),newPassword:o().when("emailSent",{is:!0,then:o().required("Please enter your new password").min(6,"Password must be at least 6 characters")})}),I=({disableSubmit:V=!1,signInUrl:g="/auth/sign-in"})=>{const[l,P]=m.useState(!1),[u,w]=m.useState(null),[d,v]=m.useState(!1),C=async(a,s)=>{var r,n;s(!0);try{(await f.post(`${j.apiPrefix}/users/request-verification-code`,{email:a.email})).status===200&&(P(!0),v(!0),c.success("Mã xác minh đã được gửi đến email của bạn"))}catch(i){const t=((n=(r=i.response)==null?void 0:r.data)==null?void 0:n.message)||i.message||"Có lỗi xảy ra!";w(t),c.error(t)}s(!1)},y=async(a,s)=>{var r,n;s(!0);try{(await f.post(`${j.apiPrefix}/users/reset-password/v2`,{email:a.email,verificationCode:a.verificationCode,newPassword:a.newPassword})).status===200&&c.success("Mật khẩu của bạn đã được đặt lại thành công")}catch(i){const t=((n=(r=i.response)==null?void 0:r.data)==null?void 0:n.message)||i.message||"Có lỗi xảy ra!";w(t),c.error(t)}s(!1)};return e.jsxs("div",{className:"forgot-password-form",children:[e.jsx(b,{}),e.jsx("div",{className:"mb-6",children:l?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mb-1",children:"Kiểm tra email của bạn"}),e.jsx("p",{children:"Chúng tôi đã gửi hướng dẫn khôi phục mật khẩu tới email của bạn"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mb-1",children:"Quên mật khẩu"}),e.jsx("p",{children:"Vui lòng nhập địa chỉ email của bạn để nhận mã xác minh"})]})}),u&&e.jsx(M,{showIcon:!0,className:"mb-4",type:"danger",children:u}),e.jsx(S,{initialValues:{email:"",verificationCode:"",newPassword:""},validationSchema:B,onSubmit:(a,{setSubmitting:s})=>{l?d?y(a,s):s(!1):C(a,s)},children:({touched:a,errors:s,isSubmitting:r,setFieldValue:n})=>e.jsx(k,{children:e.jsxs(N,{children:[!l&&!d&&e.jsx(h,{invalid:s.email&&a.email,errorMessage:s.email,children:e.jsx(p,{type:"email",autoComplete:"off",name:"email",placeholder:"Email",component:x})}),d&&e.jsxs(e.Fragment,{children:[e.jsx(h,{invalid:s.verificationCode&&a.verificationCode,errorMessage:s.verificationCode,children:e.jsx(p,{type:"text",name:"verificationCode",placeholder:"Verification Code",component:x})}),e.jsx(h,{invalid:s.newPassword&&a.newPassword,errorMessage:s.newPassword,children:e.jsx(p,{type:"password",name:"newPassword",placeholder:"New Password",component:x})})]}),e.jsx(E,{block:!0,loading:r,variant:"solid",type:"submit",children:l?"Xác nhận":"Gửi Email"}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("span",{children:"Quay lại "}),e.jsx(q,{to:g,children:"Đăng nhập"})]})]})})})]})},Q=()=>e.jsx(I,{disableSubmit:!1});export{Q as default};
