import{cx as Q,r as h,aH as U,bG as X,at as J,au as m,aD as f,cg as V,bM as g,cy as Z,aE as k,j as t,ax as ee,ay as te,az as ae,aA as d,aB as p,aC as y,ca as ne,bf as F,ci as w,B as P}from"./index-D8wAv7Ri.js";import{R as ie}from"./index.esm-Dnp-RVhZ.js";function se(c){return Q({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M1.7507,16.0022 C3.3517,20.0982 7.3367,23.0002 11.9997,23.0002 C18.0747,23.0002 22.9997,18.0752 22.9997,12.0002 M22.2497,7.9982 C20.6487,3.9012 16.6627,1.0002 11.9997,1.0002 C5.9247,1.0002 0.9997,5.9252 0.9997,12.0002 M8.9997,16.0002 L0.9997,16.0002 L0.9997,24.0002 M22.9997,0.0002 L22.9997,8.0002 L14.9997,8.0002"}}]})(c)}const re={id:"",code:"",name:"",email:"",phone:"",citizenId:"",address:"",province:null,district:null,ward:null,status:"active",note:"",birthDay:"",gender:!0,password:"",deleted:!1},oe=()=>{const[c,o]=h.useState(re),[b,L]=h.useState([]),[v,D]=h.useState([]),[Y,C]=h.useState([]),[T,z]=h.useState(!1),[$,E]=h.useState(!1),[B,M]=h.useState(!1),W=U(),{id:x}=X(),[H,R]=h.useState({currentEmail:"",currentPhone:"",email:"",phone:""}),O=J().shape({name:m().required("Họ tên khách hàng là bắt buộc").min(5,"Họ và tên khách hàng phải có ít nhất 5 ký tự").max(100,"Họ và tên khách hàng không vượt quá 100 ký tự").test("no-whitespace","Họ và tên không được chứa nhiều khoảng trắng",e=>(e==null?void 0:e.trim())===e&&!e.includes("  ")).test("no-special-characters","Họ và tên không được chứa ký tự đặc biệt hoặc số",e=>e?/^[\p{L}\s]+$/u.test(e):!1),citizenId:m().matches(/^[0-9]{12}$/,"Căn cước công dân phải có đúng 12 chữ số").required("Căn cước công dân là bắt buộc"),email:m().email("Email không hợp lệ").required("Email là bắt buộc").test("no-whitespace","Email không được chứa khoảng trắng đầu và cuối",e=>(e==null?void 0:e.trim())===e).test("email-unique","Email đã tồn tại",async e=>e===H.currentEmail?!0:!(await f.get("http://localhost:8080/api/v1/staffs/check-email",{params:{email:e}})).data.exists),birthDay:V().required("Ngày sinh là bắt buộc").max(new Date,"Ngày sinh không được là tương lai").test("age-range","Nhân viên phải trong độ tuổi từ 16 đến 40",e=>{const a=g().diff(g(e),"year");return a>=16&&a<=40}),address:m().required("Số nhà là bắt buộc"),phone:m().required("Số điện thoại là bắt buộc").matches(/(03|05|07|08|09|01[2|6|8|9])+([0-9]{8})\b/,"Số điện thoại không hợp lệ").test("phone-unique","Số điện thoại đã tồn tại",async e=>e===H.currentPhone?!0:!(await f.get("http://localhost:8080/api/v1/staffs/check-phone",{params:{phone:e}})).data.exists),province:m().required("Tỉnh/Thành phố là bắt buộc"),district:m().required("Quận/Huyện là bắt buộc"),ward:m().required("Phường/Xã là bắt buộc"),note:m(),gender:Z().required("Giới tính là bắt buộc")});h.useEffect(()=>{x&&q(x),G()},[x]),h.useEffect(()=>{if(c.province&&b.length>0){const e=b.find(a=>a.full_name===c.province);e?_(e.id):D([])}},[c.province,b]),h.useEffect(()=>{if(c.district&&v.length>0){const e=v.find(a=>a.full_name===c.district);e?I(e.id):C([])}},[c.district,v]);const G=async()=>{z(!0);try{const e=await f.get("https://esgoo.net/api-tinhthanh/1/0.htm");e.data.error===0?L(e.data.data):k.error(`Error loading provinces: ${e.data.message}`)}catch{k.error("Failed to load provinces.")}finally{z(!1)}},_=async e=>{E(!0);try{const a=await f.get(`https://esgoo.net/api-tinhthanh/2/${e}.htm`);a.data.error===0?D(a.data.data):D([])}catch{D([])}finally{E(!1)}},I=async e=>{M(!0);try{const a=await f.get(`https://esgoo.net/api-tinhthanh/3/${e}.htm`);a.data.error===0?C(a.data.data):C([])}catch{C([])}finally{M(!1)}},q=async e=>{try{const a=await f.get(`http://localhost:8080/api/v1/staffs/${e}`);console.log("Data: ",a);const l=a.data,r={...l,birthDay:g(l.birthDay,"DD-MM-YYYY").format("YYYY-MM-DD")};return o(r),R({currentEmail:l.email,currentPhone:l.phone,email:l.email,phone:l.phone}),r}catch(a){console.error("Error fetching staff:",a)}},S=(e,a,l)=>{a&&(e==="province"?(l.setFieldValue("province",a.full_name),l.setFieldValue("district",""),l.setFieldValue("ward",""),o(r=>({...r,province:a.full_name,district:null,ward:null})),_(a.id)):e==="district"?(l.setFieldValue("district",a.full_name),l.setFieldValue("ward",""),o(r=>({...r,district:a.full_name,ward:null})),I(a.id)):e==="ward"&&(l.setFieldValue("ward",a.full_name),o(r=>({...r,ward:a.full_name}))))},A=async(e,{resetForm:a,setSubmitting:l})=>{var r,j;try{const u={...e,birthDay:e.birthDay?g(e.birthDay).format("YYYY-MM-DD"):""};await f.put(`http://localhost:8080/api/v1/staffs/${x}`,u),a(),k.success("Nhân viên đã được cập nhật thành công."),W("/admin/manage/staff")}catch(u){const N=f.isAxiosError(u)?((j=(r=u.response)==null?void 0:r.data)==null?void 0:j.message)||u.message:u instanceof Error?u.message:"Có lỗi xảy ra";k.error(`Lỗi cập nhật nhân viên. ${N}`)}finally{l(!1)}},K=async e=>{if(x)try{const a=await q(x);a&&e(a)}catch(a){console.error("Failed to reset form:",a)}};return t.jsx("div",{children:t.jsxs("div",{className:"bg-white p-6 shadow-md rounded-lg mb-6 w-full",children:[t.jsx("p",{className:"text-left text-xl font-bold mx-auto mb-2",children:"CẬP NHẬT NHÂN VIÊN"}),t.jsx(ee,{initialValues:c,validationSchema:O,onSubmit:A,enableReinitialize:!0,children:({errors:e,touched:a,resetForm:l,setFieldValue:r,values:j,setValues:u,isSubmitting:N})=>t.jsx(te,{children:t.jsxs(ae,{children:[t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:[t.jsxs("div",{style:{flex:"1 1 300px",minWidth:"200px"},children:[t.jsxs(d,{asterisk:!0,label:"Họ tên nhân viên",children:[t.jsx(p,{type:"text",autoComplete:"off",name:"name",placeholder:"Nhập họ tên nhân viên...",component:y,onChange:n=>{r("name",n.target.value),o(s=>({...s,name:n.target.value}))}}),a.name&&e.name&&t.jsx("div",{style:{color:"red",fontSize:"0.875rem",marginTop:"0.25rem",minHeight:"20px"},children:e.name})]}),t.jsxs(d,{asterisk:!0,label:"Căn cước công dân",children:[t.jsx(p,{type:"text",autoComplete:"off",name:"citizenId",placeholder:"Nhập căn cước công dân...",component:y,onChange:n=>{const s=n.target.value.replace(/[^0-9]/g,"");r("citizenId",s),o(i=>({...i,citizenId:s}))},onKeyPress:n=>{/[0-9]/.test(n.key)||n.preventDefault()},value:c.citizenId||""}),a.citizenId&&e.citizenId&&t.jsx("div",{style:{color:"red",fontSize:"0.875rem",marginTop:"0.25rem",minHeight:"20px"},children:e.citizenId})]}),t.jsx(d,{asterisk:!0,label:"Ngày sinh",invalid:!!e.birthDay&&a.birthDay,errorMessage:e.birthDay,children:t.jsx(ne,{inputtable:!0,inputtableBlurClose:!1,placeholder:"Chọn ngày sinh...",value:j.birthDay?g(j.birthDay,"YYYY-MM-DD").toDate():null,onChange:n=>{const s=n?g(n).format("YYYY-MM-DD"):"";r("birthDay",s)},disableDate:n=>g(n).isAfter(g().endOf("day"))})}),t.jsx(d,{asterisk:!0,label:"Giới tính",children:t.jsx(p,{name:"gender",children:({field:n,form:s})=>t.jsxs(t.Fragment,{children:[t.jsx(F,{className:"mr-4",value:"Nam",checked:c.gender===!0,onChange:()=>{s.setFieldValue("gender",!0),o(i=>({...i,gender:!0}))},children:"Nam"}),t.jsx(F,{value:"Nữ",checked:c.gender===!1,onChange:()=>{s.setFieldValue("gender",!1),o(i=>({...i,gender:!1}))},children:"Nữ"})]})})})]}),t.jsxs("div",{style:{flex:"1 1 300px",minWidth:"200px"},children:[t.jsx(d,{asterisk:!0,label:"Tỉnh/Thành phố",children:t.jsx(p,{name:"province",children:({field:n,form:s})=>t.jsx(w,{isDisabled:T,value:b.find(i=>i.full_name===n.value)||null,placeholder:"Chọn tỉnh/thành phố...",getOptionLabel:i=>i.full_name,getOptionValue:i=>i.full_name,options:b,onChange:i=>{S("province",i,s)},onBlur:()=>s.setFieldTouched("province",!0)})})}),t.jsx(d,{asterisk:!0,label:"Quận/huyện",children:t.jsx(p,{name:"district",children:({field:n,form:s})=>t.jsx(w,{isDisabled:$||!c.province,value:v.find(i=>i.full_name===n.value)||null,placeholder:"Chọn quận/huyện...",getOptionLabel:i=>i.full_name,getOptionValue:i=>i.id,options:v,onChange:i=>{S("district",i,s)},onBlur:()=>s.setFieldTouched("district",!0)})})}),t.jsx(d,{asterisk:!0,label:"Xã/phường/thị trấn",children:t.jsx(p,{name:"ward",children:({field:n,form:s})=>t.jsx(w,{isDisabled:B||!c.district,value:Y.find(i=>i.full_name===n.value)||null,placeholder:"Chọn xã/phường/thị trấn...",getOptionLabel:i=>i.full_name,getOptionValue:i=>i.full_name,options:Y,onChange:i=>{S("ward",i,s)},onBlur:()=>s.setFieldTouched("ward",!0)})})}),t.jsx(d,{asterisk:!0,label:"Địa chỉ",invalid:!!e.address&&a.address,errorMessage:e.address,children:t.jsx(p,{type:"text",autoComplete:"off",name:"address",placeholder:"Nhập địa chỉ...",component:y,onChange:n=>{r("address",n.target.value),o(s=>({...s,address:n.target.value}))}})})]}),t.jsxs("div",{style:{flex:"1 1 300px",minWidth:"200px"},children:[t.jsxs(d,{asterisk:!0,label:"Số điện thoại",children:[t.jsx(p,{type:"text",autoComplete:"off",name:"phone",placeholder:"Nhập số điện thoại...",component:y,onChange:n=>{const s=n.target.value.replace(/[^0-9]/g,"");r("phone",s),o(i=>({...i,phone:s}))},onKeyPress:n=>{/[0-9]/.test(n.key)||n.preventDefault()},value:c.phone||""}),a.phone&&e.phone&&t.jsx("div",{style:{color:"red",fontSize:"0.875rem",marginTop:"0.25rem",minHeight:"20px"},children:e.phone})]}),t.jsxs(d,{asterisk:!0,label:"Email",children:[t.jsx(p,{type:"text",autoComplete:"off",name:"email",placeholder:"Nhập email...",component:y,onChange:n=>{r("email",n.target.value),o(s=>({...s,email:n.target.value}))}}),a.email&&e.email&&t.jsx("div",{style:{color:"red",fontSize:"0.875rem",marginTop:"0.25rem",minHeight:"20px"},children:e.email})]}),t.jsx(d,{label:"Ghi chú",children:t.jsx(p,{as:y,name:"note",placeholder:"Nhập ghi chú",textArea:!0,onChange:n=>{r("note",n.target.value),o(s=>({...s,note:n.target.value}))},style:{height:"150px"}})})]})]}),t.jsxs("div",{style:{marginTop:"1rem",display:"flex",alignItems:"center"},children:[t.jsxs(P,{type:"submit",className:"flex items-center justify-center",variant:"solid",color:"blue-600",disabled:N,style:{height:"40px",width:"200px",marginRight:"15px",lineHeight:"40px",padding:"0"},children:[t.jsx(se,{className:"mr-2",style:{fontSize:"20px"}}),"Cập Nhật"]}),t.jsxs(P,{type:"button",onClick:()=>K(u),className:"flex items-center justify-center",style:{height:"40px",width:"110px",lineHeight:"40px",padding:"0",fontSize:"15px"},children:[t.jsx(ie,{className:"mr-2",style:{fontSize:"18px"}}),"Đặt lại"]})]})]})})})]})})};export{oe as default};
