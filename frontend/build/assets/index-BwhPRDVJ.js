import{cS as K,cT as O,bW as X,bY as Q,n as f,j as e,bt as $,aE as N,r as x,aQ as G,aH as U,b6 as V,cU as W,cf as Y,cm as b,b1 as J,aC as Z,b5 as ee,B as v,ce as te,L as C,aM as se,cd as ae}from"./index-BcxyKQIP.js";import{a as L,b as ne}from"./ProductSalesService-HNZ4_tBb.js";import{u as D,b as le,R as ce,a as oe}from"./xlsx-CEEYYDki.js";import{D as re}from"./DoubleSidedImage-CvM9FDw5.js";import{k as ie}from"./ClassicLayout-fQzh7gUg.js";const k="salesProductList",g=K(k+"/getProducts",async t=>t.fetchAll?(await L({...t,pageIndex:1,pageSize:100})).data:(await L(t)).data),de=async t=>{try{return(await ne(t.id)).status===204}catch(s){throw s}},ue=t=>{const s=t.map((l,d)=>({STT:d+1,Mẫ:l.code,Tên:l.name,"Số lượng":l.quantity,"Ngày Tạo":l.createdDate,"Trạng thái":me(l.quantity)})),c=D.json_to_sheet(s),i=D.book_new();D.book_append_sheet(i,c,"Product Details"),le(i,"DANH_SACH_SAN_PHAM.xlsx")},me=t=>t===void 0||t===0?"Hết hàng":t>0&&t<=10?"Sắp hết":"Còn hàng",he={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},xe={loading:!1,deleteConfirmation:!1,selectedProduct:"",productList:[],tableData:he,filterData:{name:"",category:["bags","cloths","devices","shoes","watches"],status:[0,1,2],productStatus:0},product:[]},I=O({name:`${k}/state`,initialState:xe,reducers:{updateProductList:(t,s)=>{t.productList=s.payload},setTableData:(t,s)=>{t.tableData=s.payload},setFilterData:(t,s)=>{t.filterData=s.payload},toggleDeleteConfirmation:(t,s)=>{t.deleteConfirmation=s.payload},setSelectedProduct:(t,s)=>{t.selectedProduct=s.payload}},extraReducers:t=>{t.addCase(g.pending,s=>{s.loading=!0}).addCase(g.fulfilled,(s,c)=>{s.loading=!1,c.meta.arg.fetchAll?s.product=c.payload.content:(s.productList=c.payload.content,s.tableData.total=c.payload.totalElements,s.loading=!1)}).addCase(g.rejected,s=>{s.loading=!1})}}),{updateProductList:Te,setTableData:j,setFilterData:ke,toggleDeleteConfirmation:S,setSelectedProduct:ge}=I.actions,pe=I.reducer,fe=X({data:pe}),u=Q,be=()=>{const t=f(),s=u(r=>r.salesProductList.data.deleteConfirmation),c=u(r=>r.salesProductList.data.selectedProduct),i=u(r=>r.salesProductList.data.tableData),l=()=>{t(S(!1))},d=async()=>{t(S(!1));const r=await de({id:c});console.log(r),r?(t(g(i)),N.success("Cập nhật trạng thái thành công")):N.error("Lỗi cập nhật trạng thái. Vui lòng thử lại.")};return e.jsx($,{isOpen:s,type:"danger",title:"Xóa sản phẩm",cancelText:"Hủy",confirmText:"Xác nhận",confirmButtonColor:"red-600",onClose:l,onRequestClose:l,onCancel:l,onConfirm:d,children:e.jsx("p",{children:"Bạn có chắc chắn muốn ngừng bán sản phẩm này không? Tất sản phẩm chi tiết liên quan đến sản phẩm này cũng sẽ bị xóa."})})},je=t=>t>10?{label:"còn hàng",dotClass:"bg-emerald-500",textClass:"text-emerald-500"}:t>0?{label:"sắp hết hàng",dotClass:"bg-amber-500",textClass:"text-amber-500"}:{label:"hết hàng",dotClass:"bg-red-500",textClass:"text-red-500"},T=t=>e.jsx("div",{className:"text-lg",children:t}),ye=({row:t})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"ml-2 rtl:mr-2 font-semibold",children:t.name})}),De=()=>{const t=x.useRef(null),s=f(),{pageIndex:c,pageSize:i,sort:l,query:d,total:r}=u(a=>a.salesProductList.data.tableData),o=u(a=>a.salesProductList.data.filterData),m=u(a=>a.salesProductList.data.loading),P=u(a=>a.salesProductList.data.productList);x.useEffect(()=>{z()},[c,i,l]),x.useEffect(()=>{var a;t&&((a=t.current)==null||a.resetSorting())},[o]);const p=x.useMemo(()=>({pageIndex:c,pageSize:i,sort:l,query:d,total:r}),[c,i,l,d,r]),z=()=>{s(g({pageIndex:c,pageSize:i,sort:l,query:d,filterData:o,fetchAll:!1}))},A=({row:a})=>{const n=f(),h=()=>{n(S(!0)),n(ge(a.id))},y=(w,q)=>{h()};return e.jsxs("div",{className:"flex w-full justify-start gap-2 items-center",children:[e.jsx(W,{onClick:()=>F(a),size:20,className:"mr-3 text-2xl",style:{cursor:"pointer"}}),e.jsx(Y,{className:"text-sm",unCheckedContent:T(e.jsx(ce,{})),checkedContent:T(e.jsx(oe,{})),color:"green-500",checked:!a.deleted,onChange:y})]})},E=x.useMemo(()=>[{header:"#",id:"index",cell:a=>{const{pageIndex:n,pageSize:h}=u(B=>B.salesProductList.data.tableData),y=n??0,w=h??10;return(y-1)*w+(a.row.index+1)}},{header:"Mã",accessorKey:"code",cell:a=>{const n=a.row.original;return e.jsx("span",{className:"capitalize",children:n.code})}},{header:"Tên",accessorKey:"name",cell:a=>{const n=a.row.original;return e.jsx(ye,{row:n})}},{header:"Số Lượng",accessorKey:"quantity",cell:a=>{const n=a.row.original;return e.jsx("span",{className:"capitalize",children:n.quantity})}},{header:"Ngày tạo",accessorKey:"createdDate"},{header:"Trạng thái",accessorKey:"deleted",cell:a=>{const{quantity:n}=a.row.original,h=je(n);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:h.dotClass}),e.jsx("span",{className:`capitalize font-semibold ${h.textClass}`,children:h.label})]})}},{header:"Hành động",id:"action",cell:a=>e.jsx(A,{row:a.row.original})}],[]),M=a=>{const n=b(p);n.pageIndex=a,s(j(n))},R=a=>{const n=b(p);n.pageSize=Number(a),n.pageIndex=1,s(j(n))},H=a=>{const n=b(p);n.sort={order:a.order,key:a.key.replace("__",".")},s(j(n))},_=U(),F=a=>{const n=a.id;_(`/admin/manage/product/ProductDetail-list/${n}`)};return e.jsxs(e.Fragment,{children:[P.length>0?e.jsx(V,{ref:t,columns:E,data:P,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:m,pagingData:{total:p.total,pageIndex:p.pageIndex,pageSize:p.pageSize},onPaginationChange:M,onSelectChange:R,onSort:H}):e.jsxs("div",{className:"flex flex-col justify-center items-center h-full",children:[e.jsx(re,{className:"max-w-[200px]",src:"/img/others/image-removebg-preview-order-empty.png",darkModeSrc:"/img/others/image-removebg-preview-order-empty.png"}),e.jsx("div",{className:"mt-4 text-2xl font-semibold",children:"Không có sản phẩm nào như mô tả của bạn!!!"})]}),e.jsx(be,{})]})},Ne=()=>{const t=f(),s=x.useRef(null),c=u(o=>o.salesProductList.data.tableData),i=J(l,500);function l(o){const m=b(c);m.query=o,m.pageIndex=1,typeof o=="string"&&o.length>1&&d(m),typeof o=="string"&&o.length===0&&d(m)}const d=o=>{t(j(o)),t(g(o))},r=o=>{i(o.target.value)};return e.jsx(Z,{ref:s,className:"max-w-md md:w-65 md:mb-0 mb-4",size:"sm",placeholder:"TÌM KIẾM THEO MÃ, TÊN SẢN PHẨM...",prefix:e.jsx(ee,{className:"text-lg"}),onChange:r})},Ce=()=>{const t=f(),{pageIndex:s,pageSize:c,sort:i,query:l,total:d}=u(m=>m.salesProductList.data.tableData),r=u(m=>m.salesProductList.data.product);x.useEffect(()=>{t(g({pageIndex:s,pageSize:c,sort:i,query:l,fetchAll:!0}))},[]);const o=()=>{ue(r),N.success("Xuất thành công file sản phẩm.")};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("div",{className:"flex-grow mb-4 lg:mb-0",children:e.jsx(Ne,{})}),e.jsxs("div",{className:"flex-shrink-0 flex",children:[e.jsx("div",{className:"block lg:inline-block md:mx-2 md:mb-0 mb-4",children:e.jsx(v,{block:!0,size:"sm",onClick:o,icon:e.jsx(te,{}),children:"Xuất Excel"})}),e.jsx("div",{hidden:!ie(["ROLE_ADMIN"]),children:e.jsx(C,{className:"block lg:inline-block md:mx-2 md:mb-0 mb-4",to:"/admin/manage/product/product-new",children:e.jsx(v,{size:"sm",block:!0,variant:"solid",style:{backgroundColor:"rgb(79, 70, 229)"},className:"flex items-center justify-center gap-2 button-bg-important",icon:e.jsx(se,{}),children:"Thêm Sản Phẩm"})})})]})]})};ae("salesProductList",fe);const Ie=()=>e.jsx("div",{className:"bg-white h-full",children:e.jsxs("div",{className:"rounded-md card h-full card-border  p-5",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:[e.jsx("li",{children:e.jsx("div",{className:"flex items-center",children:e.jsx(C,{to:"/",className:"text-gray-700 hover:text-blue-600",children:"Trang Chủ"})})}),e.jsx("li",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx(C,{to:"/manage",className:"text-gray-700 hover:text-blue-600",children:"Quản Lý"})]})}),e.jsx("li",{"aria-current":"page",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("span",{className:"text-gray-500",children:"Sản phẩm"})]})})]})})}),e.jsx("h1",{className:"font-semibold text-xl mb-4 text-transform: uppercase",children:"Quản lý sản phẩm"}),e.jsx("div",{className:"mb-5 mt-6",children:e.jsx(Ce,{})}),e.jsx(De,{})]})});export{Ie as default};
